var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();import{Component,ElementRef,NgZone,Renderer2}from"@angular/core";import{thfChartAngleStepInterval,thfChartCompleteCircle,thfChartPadding,thfChartStartAngle}from"./thf-chart-pie.constant";import{ThfChartDynamicTypeComponent}from"../thf-chart-dynamic-type.component";var ThfChartPieComponent=function(t){function e(e,i,n){var r=t.call(this)||this;return r.el=e,r.ngZone=i,r.renderer=n,r.chartItemsEndAngleList=[],r.svgPathElementsList=[],r}return __extends(e,t),e.calculateEndAngle=function(t,e){return t/e*(2*Math.PI)},e.prototype.ngOnDestroy=function(){this.removeWindowResizeListener(),this.removeWindowScrollListener(),this.animationRunning=!1},e.prototype.ngOnInit=function(){this.chartInitSetup(),this.setEventListeners()},e.prototype.animationSetup=function(){this.chartItemStartAngle=thfChartStartAngle,this.chartItemEndAngle=this.chartItemsEndAngleList[0],this.animationRunning=!0,this.drawPathInit()},e.prototype.calculateAngleRadians=function(){var t=this;this.series.forEach(function(i,n){return t.chartItemsEndAngleList[n]=e.calculateEndAngle(i.value,t.totalValue)})},e.prototype.calculateCurrentEndAngle=function(t){return this.chartItemStartAngle+t>this.chartItemStartAngle+this.chartItemEndAngle?this.chartItemStartAngle+this.chartItemEndAngle-thfChartCompleteCircle:this.chartItemStartAngle+t},e.prototype.changeTooltipPosition=function(t){this.tooltipElement&&this.tooltipElement.classList.contains("thf-invisible")&&this.showTooltip();var e=this.setTooltipPositions(t);this.renderer.setStyle(this.tooltipElement,"left",e.left+"px"),this.renderer.setStyle(this.tooltipElement,"top",e.top+"px")},e.prototype.chartInitSetup=function(){this.calculateSVGContainerDimensions(this.chartWrapper,this.chartHeader,this.chartLegend),this.calculateTotalValue(),this.calculateAngleRadians(),this.createSVGElements(),this.animationSetup()},e.prototype.createPath=function(t,e,i){var n=this.renderer.createElement("svg:path","svg");this.renderer.setAttribute(n,"class","thf-path-item"),this.renderer.setAttribute(n,"fill",this.colors[t]),this.renderer.setAttribute(n,"data-tooltip-category",e.category),this.renderer.setAttribute(n,"data-tooltip-value",e.value),i.appendChild(n),this.renderer.appendChild(this.svgElement,i),this.svgPathElementsList.push(n)},e.prototype.createPaths=function(){var t=this,e=this.renderer.createElement("svg:g","svg");this.series.forEach(function(i,n){return t.createPath(n,i,e)})},e.prototype.createSVGElements=function(){this.svgElement=this.renderer.createElement("svg:svg","svg"),this.renderer.setAttribute(this.svgElement,"viewBox","0 0 "+this.chartWrapper+" "+2*this.centerX),this.renderer.setAttribute(this.svgElement,"preserveAspectRatio","xMidYMin meet"),this.renderer.setAttribute(this.svgElement,"class","thf-chart-svg-element"),this.renderer.setAttribute(this.svgElement,"width",""+(this.chartWrapper-2*thfChartPadding)),this.renderer.setAttribute(this.svgElement,"height",""+this.svgHeight),this.svgContainer.nativeElement.appendChild(this.svgElement),this.createPaths()},e.prototype.drawPath=function(t,e,i){var n=(i-e)%(2*Math.PI)>Math.PI?1:0,r=this.centerX+Math.cos(e)*this.centerX,s=this.centerX+Math.sin(e)*this.centerX,o=this.centerX+Math.cos(i)*this.centerX,h=this.centerX+Math.sin(i)*this.centerX,a=["M",r,s,"A",this.centerX,this.centerX,0,n,1,o,h,"L",this.centerX,this.centerX,"Z"].join(" ");return t.setAttribute("d",a)},e.prototype.drawPathInit=function(){var t=this;this.animationRunning&&this.ngZone.runOutsideAngular(function(){return t.drawSeries()})},e.prototype.drawSeries=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=e>this.chartItemEndAngle;t===this.svgPathElementsList.length||(i?(this.chartItemStartAngle=this.chartItemStartAngle+this.chartItemEndAngle,t++,this.chartItemEndAngle=this.chartItemsEndAngleList[t],e=0):(e+=thfChartAngleStepInterval,this.drawPath(this.svgPathElementsList[t],this.chartItemStartAngle,this.calculateCurrentEndAngle(e))),window.requestAnimationFrame(this.drawSeries.bind(this,t,e)))},e.prototype.emitEventOnEnter=function(t){this.onSerieHover.next(t)},e.prototype.onMouseClick=function(){var t={category:this.chartElementCategory,value:this.chartElementValue};this.onSerieClick.next(t)},e.prototype.onMouseEnter=function(t){this.tooltipElement=this.chartBody.nativeElement.lastChild,this.chartElementCategory=t.target.getAttributeNS(null,"data-tooltip-category"),this.chartElementValue=t.target.getAttributeNS(null,"data-tooltip-value"),this.tooltipText=this.chartElementCategory+": "+this.chartElementValue,this.showTooltip(),this.changeTooltipPosition(t);var e={category:this.chartElementCategory,value:this.chartElementValue};this.emitEventOnEnter(e)},e.prototype.onWindowResize=function(){this.calculateSVGContainerDimensions(this.chartWrapper,this.chartHeader,this.chartLegend),this.renderer.setAttribute(this.svgElement,"width",""+(this.chartWrapper-2*thfChartPadding)),this.renderer.setAttribute(this.svgElement,"height",""+this.svgHeight)},e.prototype.removeTooltip=function(){this.tooltipElement&&this.renderer.addClass(this.tooltipElement,"thf-invisible")},e.prototype.removeWindowResizeListener=function(){this.windowResizeListener&&this.windowResizeListener()},e.prototype.removeWindowScrollListener=function(){this.windowScrollListener&&this.windowScrollListener()},e.prototype.setEventListeners=function(){var t=this,e=this.el.nativeElement.querySelectorAll(".thf-path-item");(e=Array.from(e)).forEach(function(e){t.renderer.listen(e,"click",t.onMouseClick.bind(t)),t.renderer.listen(e,"mouseenter",t.onMouseEnter.bind(t)),t.renderer.listen(e,"mousemove",t.changeTooltipPosition.bind(t)),t.renderer.listen(e,"mouseleave",t.removeTooltip.bind(t))}),this.windowResizeListener=this.renderer.listen(window,"resize",this.onWindowResize.bind(this)),this.windowScrollListener=this.renderer.listen(this.checkingIfScrollsWithThfPage(),"scroll",this.removeTooltip.bind(this))},e.prototype.checkingIfScrollsWithThfPage=function(){var t=document.getElementsByClassName("thf-page-content");return t.length?t[0]:window},e.prototype.setTooltipPositions=function(t){return{left:t.clientX-this.tooltipElement.offsetWidth/2,top:t.clientY-this.tooltipElement.offsetHeight-8}},e.prototype.showTooltip=function(){this.renderer.removeClass(this.tooltipElement,"thf-invisible")},e.decorators=[{type:Component,args:[{selector:"thf-chart-pie",template:'<div #chartBody class="thf-chart-body"> <div #svgContainer class="thf-chart-svg-container"></div> <div class="thf-chart-tooltip thf-tooltip thf-invisible"> <div class="thf-tooltip-arrow thf-arrow-bottom"></div> <div class="thf-tooltip-content">{{ tooltipText }}</div> </div> </div>'}]}],e.ctorParameters=function(){return[{type:ElementRef},{type:NgZone},{type:Renderer2}]},e}(ThfChartDynamicTypeComponent);export{ThfChartPieComponent};