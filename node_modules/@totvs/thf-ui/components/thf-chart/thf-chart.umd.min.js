!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs","@angular/common"],e):e(t["thf-chart"]={},t.core,t.rxjs,t.common)}(this,function(t,e,i,r){"use strict";var n={Pie:"pie"};var o,s=400,h=n.Pie,a=function(){function t(){this._height=s,this._type=h,this.thfChartType=n,this.seriesClick=new e.EventEmitter,this.seriesHover=new e.EventEmitter}return Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(t){var e,i=function(t,e){var i=parseInt(t,10),r=parseInt(e,10);return i||0===i?i:r||0===r?r:void 0}(t);e=typeof t==="number"?i<=200?200:i:s,this._height=e,this.rebuildComponent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),t.prototype.onSeriesClick=function(t){this.seriesClick.emit(t)},t.prototype.onSeriesHover=function(t){this.seriesHover.emit(t)},t.propDecorators={height:[{type:e.Input,args:["t-height"]}],series:[{type:e.Input,args:["t-series"]}],title:[{type:e.Input,args:["t-title"]}],seriesClick:[{type:e.Output,args:["t-series-click"]}],seriesHover:[{type:e.Output,args:["t-series-hover"]}]},t}(),c=[["#29B6C5"],["#0C6C94","#29B6C5"],["#0C6C94","#29B6C5","#C9ECF0"],["#0C6C94","#0B92B4","#29B6C5","#94DAE2"],["#0C6C94","#0B92B4","#29B6C5","#94DAE2","#C9ECF0"],["#0C6C94","#00A5C5","#0082A8","#31628D","#364473","#32285C"],["#0C6C94","#00AACB","#018DAE","#277099","#325783","#35426E","#32285D"],["#0C6C94","#00AFCE","#0194B6","#117FA2","#0088AC","#23789F","#2B6992","#32285C"],["#0C6C94","#00BAD5","#00A7C7","#0197B8","#0088AC","#23789F","#2B6992","#315C87","#32285C"],["#0C6C94","#00BAD5","#00A7C7","#0197B8","#0088AC","#23789F","#2B6992","#315C87","#364E7C","#32285C"],["#0C6C94","#00BAD5","#00A7C7","#0197B8","#0088AC","#23789F","#2B6992","#315C87","#364E7C","#36436F","#32285C"],["#0C6C94","#00BAD5","#00A7C7","#0197B8","#0088AC","#23789F","#2B6992","#315C87","#364E7C","#36436F","#333565","#32285C"]],l=2*Math.PI/Math.floor(25),p=-Math.PI/2,u=function(){function t(){this.onSerieClick=new i.Subject,this.onSerieHover=new i.Subject,this.series=[]}return t.prototype.calculateSVGContainerDimensions=function(t,e,i){var r=this.height-e-i-48;this.svgHeight=r<=0?0:r,this.centerX=t/2},t.prototype.calculateTotalValue=function(){this.totalValue=this.series.reduce(function(t,e){return t+e.value},0)},t.propDecorators={chartBody:[{type:e.ViewChild,args:["chartBody"]}],svgContainer:[{type:e.ViewChild,args:["svgContainer"]}]},t}(),d=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),f=function(t){function i(e,i,r){var n=t.call(this)||this;return n.el=e,n.ngZone=i,n.renderer=r,n.chartItemsEndAngleList=[],n.svgPathElementsList=[],n}return d(i,t),i.calculateEndAngle=function(t,e){return t/e*(2*Math.PI)},i.prototype.ngOnDestroy=function(){this.removeWindowResizeListener(),this.removeWindowScrollListener(),this.animationRunning=!1},i.prototype.ngOnInit=function(){this.chartInitSetup(),this.setEventListeners()},i.prototype.animationSetup=function(){this.chartItemStartAngle=p,this.chartItemEndAngle=this.chartItemsEndAngleList[0],this.animationRunning=!0,this.drawPathInit()},i.prototype.calculateAngleRadians=function(){var t=this;this.series.forEach(function(e,r){return t.chartItemsEndAngleList[r]=i.calculateEndAngle(e.value,t.totalValue)})},i.prototype.calculateCurrentEndAngle=function(t){return this.chartItemStartAngle+t>this.chartItemStartAngle+this.chartItemEndAngle?this.chartItemStartAngle+this.chartItemEndAngle-1e-4:this.chartItemStartAngle+t},i.prototype.changeTooltipPosition=function(t){this.tooltipElement&&this.tooltipElement.classList.contains("thf-invisible")&&this.showTooltip();var e=this.setTooltipPositions(t);this.renderer.setStyle(this.tooltipElement,"left",e.left+"px"),this.renderer.setStyle(this.tooltipElement,"top",e.top+"px")},i.prototype.chartInitSetup=function(){this.calculateSVGContainerDimensions(this.chartWrapper,this.chartHeader,this.chartLegend),this.calculateTotalValue(),this.calculateAngleRadians(),this.createSVGElements(),this.animationSetup()},i.prototype.createPath=function(t,e,i){var r=this.renderer.createElement("svg:path","svg");this.renderer.setAttribute(r,"class","thf-path-item"),this.renderer.setAttribute(r,"fill",this.colors[t]),this.renderer.setAttribute(r,"data-tooltip-category",e.category),this.renderer.setAttribute(r,"data-tooltip-value",e.value),i.appendChild(r),this.renderer.appendChild(this.svgElement,i),this.svgPathElementsList.push(r)},i.prototype.createPaths=function(){var t=this,e=this.renderer.createElement("svg:g","svg");this.series.forEach(function(i,r){return t.createPath(r,i,e)})},i.prototype.createSVGElements=function(){this.svgElement=this.renderer.createElement("svg:svg","svg"),this.renderer.setAttribute(this.svgElement,"viewBox","0 0 "+this.chartWrapper+" "+2*this.centerX),this.renderer.setAttribute(this.svgElement,"preserveAspectRatio","xMidYMin meet"),this.renderer.setAttribute(this.svgElement,"class","thf-chart-svg-element"),this.renderer.setAttribute(this.svgElement,"width",""+(this.chartWrapper-48)),this.renderer.setAttribute(this.svgElement,"height",""+this.svgHeight),this.svgContainer.nativeElement.appendChild(this.svgElement),this.createPaths()},i.prototype.drawPath=function(t,e,i){var r=(i-e)%(2*Math.PI)>Math.PI?1:0,n=this.centerX+Math.cos(e)*this.centerX,o=this.centerX+Math.sin(e)*this.centerX,s=this.centerX+Math.cos(i)*this.centerX,h=this.centerX+Math.sin(i)*this.centerX,a=["M",n,o,"A",this.centerX,this.centerX,0,r,1,s,h,"L",this.centerX,this.centerX,"Z"].join(" ");return t.setAttribute("d",a)},i.prototype.drawPathInit=function(){var t=this;this.animationRunning&&this.ngZone.runOutsideAngular(function(){return t.drawSeries()})},i.prototype.drawSeries=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=e>this.chartItemEndAngle;t===this.svgPathElementsList.length||(i?(this.chartItemStartAngle=this.chartItemStartAngle+this.chartItemEndAngle,t++,this.chartItemEndAngle=this.chartItemsEndAngleList[t],e=0):(e+=l,this.drawPath(this.svgPathElementsList[t],this.chartItemStartAngle,this.calculateCurrentEndAngle(e))),window.requestAnimationFrame(this.drawSeries.bind(this,t,e)))},i.prototype.emitEventOnEnter=function(t){this.onSerieHover.next(t)},i.prototype.onMouseClick=function(){var t={category:this.chartElementCategory,value:this.chartElementValue};this.onSerieClick.next(t)},i.prototype.onMouseEnter=function(t){this.tooltipElement=this.chartBody.nativeElement.lastChild,this.chartElementCategory=t.target.getAttributeNS(null,"data-tooltip-category"),this.chartElementValue=t.target.getAttributeNS(null,"data-tooltip-value"),this.tooltipText=this.chartElementCategory+": "+this.chartElementValue,this.showTooltip(),this.changeTooltipPosition(t);var e={category:this.chartElementCategory,value:this.chartElementValue};this.emitEventOnEnter(e)},i.prototype.onWindowResize=function(){this.calculateSVGContainerDimensions(this.chartWrapper,this.chartHeader,this.chartLegend),this.renderer.setAttribute(this.svgElement,"width",""+(this.chartWrapper-48)),this.renderer.setAttribute(this.svgElement,"height",""+this.svgHeight)},i.prototype.removeTooltip=function(){this.tooltipElement&&this.renderer.addClass(this.tooltipElement,"thf-invisible")},i.prototype.removeWindowResizeListener=function(){this.windowResizeListener&&this.windowResizeListener()},i.prototype.removeWindowScrollListener=function(){this.windowScrollListener&&this.windowScrollListener()},i.prototype.setEventListeners=function(){var t=this,e=this.el.nativeElement.querySelectorAll(".thf-path-item");(e=Array.from(e)).forEach(function(e){t.renderer.listen(e,"click",t.onMouseClick.bind(t)),t.renderer.listen(e,"mouseenter",t.onMouseEnter.bind(t)),t.renderer.listen(e,"mousemove",t.changeTooltipPosition.bind(t)),t.renderer.listen(e,"mouseleave",t.removeTooltip.bind(t))}),this.windowResizeListener=this.renderer.listen(window,"resize",this.onWindowResize.bind(this)),this.windowScrollListener=this.renderer.listen(this.checkingIfScrollsWithThfPage(),"scroll",this.removeTooltip.bind(this))},i.prototype.checkingIfScrollsWithThfPage=function(){var t=document.getElementsByClassName("thf-page-content");return t.length?t[0]:window},i.prototype.setTooltipPositions=function(t){return{left:t.clientX-this.tooltipElement.offsetWidth/2,top:t.clientY-this.tooltipElement.offsetHeight-8}},i.prototype.showTooltip=function(){this.renderer.removeClass(this.tooltipElement,"thf-invisible")},i.decorators=[{type:e.Component,args:[{selector:"thf-chart-pie",template:'<div #chartBody class="thf-chart-body"> <div #svgContainer class="thf-chart-svg-container"></div> <div class="thf-chart-tooltip thf-tooltip thf-invisible"> <div class="thf-tooltip-arrow thf-arrow-bottom"></div> <div class="thf-tooltip-content">{{ tooltipText }}</div> </div> </div>'}]}],i.ctorParameters=function(){return[{type:e.ElementRef},{type:e.NgZone},{type:e.Renderer2}]},i}(u),g=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),m=function(t){function r(e,r,o){var s,h=t.call(this)||this;return h.changeDetector=e,h.componentFactoryResolver=r,h.differs=o,h.calculatedElement=!1,h.initialized=!1,h.windowResizeListener=new i.Subject,h.mappings=((s={})[n.Pie]=f,s),h.onResize=function(){return h.windowResizeListener.next()},h.differ=h.differs.find([]).create(null),h}return g(r,t),r.prototype.ngAfterViewInit=function(){this.initialized=!0},r.prototype.ngDoCheck=function(){this.chartWrapper.nativeElement.offsetWidth&&!this.calculatedElement&&this.initialized&&(this.calculatedElement=!0,this.getSeriesColor(),this.dynamicComponentSetting()),this.checkingForSerieChanges()},r.prototype.ngOnDestroy=function(){this.removeWindowResizeListener()},r.prototype.ngOnInit=function(){this.getSeriesColor()},r.prototype.rebuildComponent=function(){this.componentRef&&(this.componentRef.destroy(),this.dynamicComponentSetting())},r.prototype.checkingForSerieChanges=function(){this.componentRef&&this.differ&&(this.differ.diff(this.series)&&(this.getSeriesColor(),this.rebuildComponent()))},r.prototype.createComponent=function(){var t=this.getComponentType(this.type),e=this.componentFactoryResolver.resolveComponentFactory(t);this.componentRef=this.chartContainer.createComponent(e);var i=this.componentRef.instance;return this.setChartProperties(i),i},r.prototype.dynamicComponentSetting=function(){var t=this.createComponent();this.setResizeListenerSubscribe(t),this.changeDetector.detectChanges(),this.setClickSubscribe(t),this.setHoverSubscribe(t)},r.prototype.getComponentType=function(t){return this.mappings[t]},r.prototype.getSeriesColor=function(){var t=c.length-1;if(!this.series)return this.colors=c[t];var e=this.series.length-1;if(e>t){for(var i=c[t],r=e/t,n=1;n<=r;n++)i=i.concat(c[t]);return this.colors=i}return this.colors=c[e]},r.prototype.removeWindowResizeListener=function(){this.onResize&&(this.onResize=function(){})},r.prototype.setChartProperties=function(t){t.chartHeader=this.chartHeader.nativeElement.offsetHeight,t.chartLegend=this.chartLegend.nativeElement.offsetHeight,t.chartWrapper=this.chartWrapper.nativeElement.offsetWidth,t.colors=this.colors,t.height=this.height,t.series=this.series||[]},r.prototype.setClickSubscribe=function(t){var e=this;t.onSerieClick.subscribe(function(t){e.onSeriesClick(t)})},r.prototype.setHoverSubscribe=function(t){var e=this;t.onSerieHover.subscribe(function(t){e.onSeriesHover(t)})},r.prototype.setResizeListenerSubscribe=function(t){var e=this;this.windowResizeListener.subscribe(function(){t.chartHeader=e.chartHeader.nativeElement.offsetHeight,t.chartLegend=e.chartLegend.nativeElement.offsetHeight,t.chartWrapper=e.chartWrapper.nativeElement.offsetWidth})},r.decorators=[{type:e.Component,args:[{selector:"thf-chart",template:'<div #chartWrapper class="thf-chart-wrapper"> <div #chartHeader class="thf-chart-header"> <div class="thf-chart-title">{{ title }}</div> </div> <ng-template #chartContainer></ng-template> <div #chartLegend class="thf-chart-legend"> <div class="thf-chart-legend-container"> <div class="thf-chart-legend-item" *ngFor="let serie of series; let i = index"> <div class="thf-chart-legend-square" [style.background]="colors[i]"></div> <span class="thf-chart-legend-text">{{ serie.category }}</span> </div> </div> </div> </div> '}]}],r.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:e.ComponentFactoryResolver},{type:e.IterableDiffers}]},r.propDecorators={chartContainer:[{type:e.ViewChild,args:["chartContainer",{read:e.ViewContainerRef}]}],chartHeader:[{type:e.ViewChild,args:["chartHeader"]}],chartLegend:[{type:e.ViewChild,args:["chartLegend"]}],chartWrapper:[{type:e.ViewChild,args:["chartWrapper"]}],onResize:[{type:e.HostListener,args:["window:resize",["$event"]]}]},r}(a),v=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[r.CommonModule],declarations:[m,f],entryComponents:[f],exports:[m]}]}],t}();t.ThfChartType=n,t.ThfChartComponent=m,t.ThfChartModule=v,Object.defineProperty(t,"__esModule",{value:!0})});