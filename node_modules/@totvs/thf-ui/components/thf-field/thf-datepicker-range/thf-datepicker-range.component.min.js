var __extends=this&&this.__extends||function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,a=1,n=arguments.length;a<n;a++)for(var i in e=arguments[a])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};import{Component,ElementRef,forwardRef,ViewChild}from"@angular/core";import{NG_VALIDATORS,NG_VALUE_ACCESSOR}from"@angular/forms";import{ThfDatepickerRangeBaseComponent}from"./thf-datepicker-range-base.component";import{ThfDateService}from"./../../../services/thf-date/thf-date.service";import{ThfMask}from"../thf-input/thf-mask";var arrowLeftKey=37,arrowRightKey=39,backspaceKey=8,thfDatepickerRangeDateLengthDefault=10,ThfDatepickerRangeComponent=function(t){function e(e,a){var n=t.call(this,e)||this;return n.thfDatepickerRangeElement=a,n}return __extends(e,t),Object.defineProperty(e.prototype,"enableCleaner",{get:function(){return(this.startDateInputValue||this.endDateInputValue)&&!this.disabled&&!this.readonly},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endDateInputName",{get:function(){return"end-date"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endDateInputValue",{get:function(){return this.endDateInput.nativeElement.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getErrorMessage",{get:function(){return""!==this.errorMessage&&this.hasInvalidClass()?this.errorMessage:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDateRangeInputUncompleted",{get:function(){return this.endDateInputValue.length<thfDatepickerRangeDateLengthDefault&&this.startDateInputValue.length<thfDatepickerRangeDateLengthDefault},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDirtyDateRangeInput",{get:function(){return this.endDateInputValue.length>0||this.startDateInputValue.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDateInputName",{get:function(){return"start-date"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDateInputValue",{get:function(){return this.startDateInput.nativeElement.value},enumerable:!0,configurable:!0}),e.getKeyCode=function(t){return t.keyCode||t.which},e.getTargetElement=function(t){return t.target||t.srcElement},e.isValidKey=function(t){return t>=48&&t<=57||t>=96&&t<=105},e.prototype.ngOnInit=function(){this.thfMaskObject=this.buildMask()},e.prototype.clear=function(){this.resetDateRangeInputValidation(),this.dateRange={start:"",end:""},this.updateScreenByModel(this.dateRange),this.updateModel(this.dateRange)},e.prototype.onBlur=function(){this.removeFocusFromDatePickerRangeField()},e.prototype.onFocus=function(){this.applyFocusOnDatePickerRangeField()},e.prototype.onKeydown=function(t){this.readonly||(this.isSetFocusOnBackspace(t)?(t.preventDefault(),this.setFocusOnBackspace()):this.thfMaskObject.keydown(t))},e.prototype.onKeyup=function(t){if(!this.readonly){var e=t.target.name===this.startDateInputName;this.setFocus(t),this.thfMaskObject.keyup(t),this.updateModelByScreen(e)}},e.prototype.resetDateRangeInputValidation=function(){this.isStartDateRangeInputValid=!0,this.isDateRangeInputFormatValid=!0},e.prototype.updateScreenByModel=function(t){var e=this,a={start:t.start,end:t.end},n=this.thfDateService.isDateRangeValid(a.end,a.start),i=function(t){return!e.dateFormatFailed(t)&&n},r=i(a.end)?this.formatModelToScreen(a.end):"",o=i(a.start)?this.formatModelToScreen(a.start):"";this.endDateInput.nativeElement.value=r,this.startDateInput.nativeElement.value=o},e.prototype.applyFocusOnDatePickerRangeField=function(){this.dateRangeField.nativeElement.classList.add("thf-datepicker-range-field-focused")},e.prototype.buildMask=function(){var t=this.format.toUpperCase();return t=(t=(t=t.replace(/DD/g,"99")).replace(/MM/g,"99")).replace(/YYYY/g,"9999"),new ThfMask(t,!0)},e.prototype.formatDate=function(t,e,a,n){void 0===e&&(e=""),void 0===a&&(a=""),void 0===n&&(n="");var i=t;return e=e&&e.includes("T")?e.slice(0,2):e,i=(i=(i=i.replace("dd",("0"+e).slice(-2))).replace("mm",("0"+a).slice(-2))).replace("yyyy",String(n))},e.prototype.formatScreenToModel=function(t){void 0===t&&(t="");var e=t.split("/"),a=e[0],n=e[1],i=e[2];return t?this.formatDate("yyyy-mm-dd",a,n,i):""},e.prototype.formatModelToScreen=function(t){void 0===t&&(t="");var e=t.split("-"),a=e[0],n=e[1],i=e[2];return t?this.formatDate(this.format,i,n,a):""},e.prototype.getDateRangeFormatValidation=function(t,e,a){return this.setDateRangeInputValidation(t,e),{isValid:this.isDateRangeInputFormatValid&&this.isStartDateRangeInputValid,dateRangeModel:this.getValidatedModel(t,e,a)}},e.prototype.getValidatedModel=function(t,e,a){var n={start:"",end:""};return n.end=!a&&!this.isStartDateRangeInputValid||this.dateFormatFailed(e)?"":e,n.start=a&&!this.isStartDateRangeInputValid||this.dateFormatFailed(t)?"":t,n},e.prototype.hasInvalidClass=function(){return this.thfDatepickerRangeElement.nativeElement.classList.contains("ng-invalid")&&this.thfDatepickerRangeElement.nativeElement.classList.contains("ng-dirty")},e.prototype.isEqualBeforeValue=function(t,e){return this.isDateRangeInputFormatValid&&e===this.dateRange.end&&t===this.dateRange.start},e.prototype.isSetFocusOnBackspace=function(t){return t.target.name===this.endDateInputName&&0===this.endDateInput.nativeElement.selectionStart&&0===this.endDateInput.nativeElement.selectionEnd&&t.keyCode===backspaceKey},e.prototype.removeFocusFromDatePickerRangeField=function(){this.dateRangeField.nativeElement.classList.remove("thf-datepicker-range-field-focused")},e.prototype.setDateRangeInputValidation=function(t,e){this.isStartDateRangeInputValid=this.thfDateService.isDateRangeValid(e,t),this.isDateRangeInputFormatValid=!this.dateFormatFailed(t)&&!this.dateFormatFailed(e)},e.prototype.setFocus=function(t){var a=e.getTargetElement(t),n=e.getKeyCode(t),i=a.name;this.setFocusOnArrowLeft(n,i),this.setFocusOnArrowRight(n,i,a),this.setFocusOnStartDateCompleted(n,i)},e.prototype.setFocusAndPosition=function(t,e,a){var n=this;this.focusOnElement(e),setTimeout(function(){e.nativeElement.setSelectionRange(a,a),n.thfMaskObject.initialPosition=t,n.thfMaskObject.finalPosition=t})},e.prototype.focusOnElement=function(t){t.nativeElement.focus()},e.prototype.setFocusOnArrowLeft=function(t,e){var a=0===this.endDateInput.nativeElement.selectionStart;if(e===this.endDateInputName&&a&&t===arrowLeftKey){var n=this.startDateInput.nativeElement.value.length;this.setFocusAndPosition(n,this.startDateInput,n)}},e.prototype.setFocusOnArrowRight=function(t,e,a){var n=this.startDateInput.nativeElement.selectionStart===a.value.length;e===this.startDateInputName&&n&&t===arrowRightKey&&this.setFocusAndPosition(0,this.endDateInput,0)},e.prototype.setFocusOnBackspace=function(){var t=this.startDateInput.nativeElement.value.length;this.startDateInput.nativeElement.value=this.startDateInputValue.slice(0,-1),this.setFocusAndPosition(t,this.startDateInput,t)},e.prototype.setFocusOnStartDateCompleted=function(t,a){var n=this.startDateInput.nativeElement.selectionStart===thfDatepickerRangeDateLengthDefault,i=this.startDateInputValue.length===thfDatepickerRangeDateLengthDefault&&n,r=e.isValidKey(t);a===this.startDateInputName&&i&&r&&this.setFocusAndPosition(0,this.endDateInput,0)},e.prototype.updateModelByScreen=function(t){var e=this.formatScreenToModel(this.endDateInputValue),a=this.formatScreenToModel(this.startDateInputValue);if(this.isDateRangeInputUncompleted&&this.isDirtyDateRangeInput)this.updateModel(this.dateRange);else{if(this.isEqualBeforeValue(a,e))return this.resetDateRangeInputValidation(),void this.validateModel(this.dateRange);var n=this.getDateRangeFormatValidation(a,e,t);n.isValid&&(this.dateRange={start:a,end:e},this.updateModel(this.dateRange),this.onChange.emit(__assign({},this.dateRange))),n.isValid||(this.dateRange=__assign({},n.dateRangeModel),this.updateModel(n.dateRangeModel))}},e.decorators=[{type:Component,args:[{selector:"thf-datepicker-range",template:'<thf-field-container [t-help]="help" [t-label]="label" [t-opcional]="!required"> <div #dateRangeField class="thf-datepicker-range-field thf-input" [class.thf-datepicker-range-field-disabled]="disabled"> <div class="thf-datepicker-range-start-date"> <input #startDateInput class="thf-datepicker-range-input" maxlength="10" type="text" [disabled]="disabled" [name]="startDateInputName" [readonly]="readonly" (blur)="onBlur()" (focus)="onFocus()" (keydown)="onKeydown($event)" (keyup)="onKeyup($event)"> </div> <div class="thf-datepicker-range-separator">-</div> <div class="thf-datepicker-range-end-date"> <input #endDateInput class="thf-datepicker-range-input" maxlength="10" type="text" [disabled]="disabled" [name]="endDateInputName" [readonly]="readonly" (blur)="onBlur()" (focus)="onFocus()" (keydown)="onKeydown($event)" (keyup)="onKeyup($event)"> </div> <div class="thf-datepicker-range-icon"> <thf-clean *ngIf="enableCleaner" (t-change-event)="clear($event)"></thf-clean> </div> <div class="thf-datepicker-range-icon"> <span class="thf-icon thf-field-icon thf-icon-calendar" [class.thf-field-icon-disabled]="disabled || readonly"> </span> </div> </div> <thf-field-container-bottom [t-error-pattern]="getErrorMessage"></thf-field-container-bottom> </thf-field-container> ',providers:[{provide:NG_VALUE_ACCESSOR,useExisting:forwardRef(function(){return e}),multi:!0},{provide:NG_VALIDATORS,useExisting:forwardRef(function(){return e}),multi:!0}]}]}],e.ctorParameters=function(){return[{type:ThfDateService},{type:ElementRef}]},e.propDecorators={dateRangeField:[{type:ViewChild,args:["dateRangeField",{read:ElementRef}]}],endDateInput:[{type:ViewChild,args:["endDateInput",{read:ElementRef}]}],startDateInput:[{type:ViewChild,args:["startDateInput",{read:ElementRef}]}]},e}(ThfDatepickerRangeBaseComponent);export{ThfDatepickerRangeComponent};