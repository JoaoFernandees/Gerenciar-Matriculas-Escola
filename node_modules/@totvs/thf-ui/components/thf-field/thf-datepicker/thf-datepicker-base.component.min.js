import{EventEmitter,Input,Output}from"@angular/core";import{convertDateToISODate,convertDateToISOExtended,convertIsoToDate,convertToBoolean,formatYear,isTypeof,setYearFrom0To100,validateDateRange}from"../../../utils/util";import{dateFailed,requiredFailed}from"./../validators";import{ThfMask}from"../thf-input/thf-mask";var thfDatepickerFormatDefault="dd/mm/yyyy",ThfDatepickerBaseComponent=function(){function t(){this._format=thfDatepickerFormatDefault,this._placeholder="",this.firstStart=!0,this.hour="T00:00:01-00:00",this.isExtendedISO=!0,this.onChangeModel=null,this.onTouchedModel=null,this.disabled=!1,this.readonly=!1,this.required=!1,this.focus=!1,this.clean=!1,this.errorPattern="",this.onblur=new EventEmitter,this.onchange=new EventEmitter}return Object.defineProperty(t.prototype,"placeholder",{get:function(){return this._placeholder},set:function(t){this._placeholder=isTypeof(t,"string")?t:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setDisabled",{set:function(t){this.disabled=""===t||convertToBoolean(t),this.validateModel(convertDateToISOExtended(this.date,this.hour))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setReadonly",{set:function(t){this.readonly=""===t||convertToBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setRequired",{set:function(t){this.required=""===t||convertToBoolean(t),this.validateModel(convertDateToISOExtended(this.date,this.hour))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setFocus",{set:function(t){this.focus=""===t||convertToBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setClean",{set:function(t){this.clean=""===t||convertToBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setDateStart",{set:function(t){if(t instanceof Date){var e=t.getFullYear(),r=new Date(e,t.getMonth(),t.getDate(),0,0,0);setYearFrom0To100(r,e),this.start=r}else this.start=convertIsoToDate(t,!0,!1);this.validateModel(convertDateToISOExtended(this.date,this.hour))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setDateEnd",{set:function(t){if(t instanceof Date){var e=t.getFullYear(),r=new Date(e,t.getMonth(),t.getDate(),23,59,59);setYearFrom0To100(r,e),this.end=r}else this.end=convertIsoToDate(t,!1,!0);this.validateModel(convertDateToISOExtended(this.date,this.hour))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._format},set:function(t){if(t&&(t=t.toLowerCase()).match(/dd/)&&t.match(/mm/)&&t.match(/yyyy/))return this._format=t,this.objMask=this.buildMask(),void this.refreshValue(this.date);this._format=thfDatepickerFormatDefault,this.objMask=this.buildMask()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"locale",{get:function(){return this._locale||navigator.language},set:function(t){this._locale=t?t.length>=2?t:"pt":navigator.language},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.objMask=this.buildMask()},t.prototype.getDateFromString=function(t){var e=parseInt(t.substring(this.format.indexOf("d"),this.format.indexOf("d")+2),10),r=parseInt(t.substring(this.format.indexOf("m"),this.format.indexOf("m")+2),10)-1,a=parseInt(t.substring(this.format.indexOf("y"),this.format.indexOf("y")+4),10),o=new Date(a,r,e);return setYearFrom0To100(o,a),o.getFullYear()===a&&o.getMonth()===r&&o.getDate()===e?o:null},t.prototype.formatToDate=function(t){var e=this.format;return e=(e=(e=e.replace("dd",("0"+t.getDate()).slice(-2))).replace("mm",("0"+(t.getMonth()+1)).slice(-2))).replace("yyyy",formatYear(t.getFullYear()))},t.prototype.controlModel=function(t){this.date=t,t&&this.isExtendedISO?this.callOnChange(convertDateToISOExtended(this.date,this.hour)):t&&!this.isExtendedISO?this.callOnChange(convertDateToISODate(this.date)):void 0===t?this.callOnChange(""):this.callOnChange("Data inválida")},t.prototype.callOnChange=function(t){this.onChangeModel&&this.onChangeModel(t)},t.prototype.registerOnChange=function(t){this.onChangeModel=t},t.prototype.registerOnTouched=function(t){this.onTouchedModel=t},t.prototype.registerOnValidatorChange=function(t){this.validatorChange=t},t.prototype.validateModel=function(t){this.validatorChange&&this.validatorChange(t)},t.prototype.buildMask=function(){var t=this.format.toUpperCase();return t=(t=(t=t.replace(/DD/g,"99")).replace(/MM/g,"99")).replace(/YYYY/g,"9999"),new ThfMask(t,!0)},t.prototype.validate=function(t){return this.errorPattern="Data inválida"!==this.errorPattern&&"Data fora do período"!==this.errorPattern?this.errorPattern:"",dateFailed(t.value)?(this.errorPattern=this.errorPattern||"Data inválida",{date:{valid:!1}}):requiredFailed(this.required,this.disabled,t.value)?{required:{valid:!1}}:this.date&&!validateDateRange(this.date,this.start,this.end)?(this.errorPattern=this.errorPattern||"Data fora do período",{date:{valid:!1}}):null},t.propDecorators={name:[{type:Input,args:["name"]}],placeholder:[{type:Input,args:["t-placeholder"]}],setDisabled:[{type:Input,args:["t-disabled"]}],setReadonly:[{type:Input,args:["t-readonly"]}],setRequired:[{type:Input,args:["t-required"]}],setFocus:[{type:Input,args:["t-focus"]}],setClean:[{type:Input,args:["t-clean"]}],errorPattern:[{type:Input,args:["t-error-pattern"]}],setDateStart:[{type:Input,args:["t-start"]}],setDateEnd:[{type:Input,args:["t-end"]}],format:[{type:Input,args:["t-format"]}],locale:[{type:Input,args:["t-locale"]}],onblur:[{type:Output,args:["t-blur"]}],onchange:[{type:Output,args:["t-change"]}]},t}();export{ThfDatepickerBaseComponent};