var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();import{Component,ElementRef,forwardRef,HostListener,Input,Renderer2,ViewChild}from"@angular/core";import{NG_VALIDATORS,NG_VALUE_ACCESSOR}from"@angular/forms";import{formatYear,isMobile,setYearFrom0To100}from"../../../utils/util";import{ThfControlPositionService}from"./../../../services/thf-control-position/thf-control-position.service";import{ThfCalendarComponent}from"./thf-calendar/thf-calendar.component";import{ThfDatepickerBaseComponent}from"./thf-datepicker-base.component";var thfCalendarContentOffset=8,thfCalendarPositionDefault="bottom-left",ThfDatepickerComponent=function(t){function e(e,i,n){var o=t.call(this)||this;return o.controlPosition=e,o.renderer=i,o.dateRegex=new RegExp("^(?:[0-9])\\d{1}(?:[0-9])\\d{1}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12]\\d|3[01])$"),o.isoRegex=new RegExp("^(?:[0-9])\\d{1}(?:[0-9])\\d{1}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12]\\d|3[01])T(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d(?:Z|-0[1-9]|-1\\d|-2[0-3]|-00:?(?:0[1-9]|[0-5]\\d)|\\+[01]\\d|\\+2[0-3])(?:|:?[0-5]\\d)$"),o.onScroll=function(){o.controlPosition.adjustPosition(thfCalendarPositionDefault)},o.el=n,o}return __extends(e,t),e.prototype.ngAfterViewInit=function(){this.setDialogPickerStyleDisplay("none"),this.focus&&this.inputEl.nativeElement.focus()},e.prototype.ngOnDestroy=function(){this.removeListeners()},e.prototype.togglePicker=function(){this.disabled||this.readonly||(this.calendar.visible?(this.inputEl.nativeElement.disabled=!1,this.closeCalendar()):(this.calendar.init(),this.setCalendarPosition(),this.initializeListeners()))},e.prototype.dateSelected=function(){this.inputEl.nativeElement.focus(),this.inputEl.nativeElement.value=this.formatToDate(this.date),this.controlModel(this.date),this.closeCalendar()},e.prototype.wasClickedOnPicker=function(t){this.dialogPicker&&this.iconDatepicker&&(this.dialogPicker.nativeElement.contains(t.target)&&!this.hasOverlayClass(t.target)||this.iconDatepicker.nativeElement.contains(t.target)||this.hasAttrCalendar(t.target)||this.closeCalendar())},e.prototype.onKeyup=function(t){this.readonly||(this.objMask.keyup(t),this.objMask.valueToModel||""===this.objMask.valueToModel?this.objMask.valueToModel.length>=10?(this.controlModel(this.getDateFromString(this.inputEl.nativeElement.value)),this.date=this.getDateFromString(this.inputEl.nativeElement.value)):(this.date=void 0,this.controlModel(this.date)):this.date=void 0)},e.prototype.onKeydown=function(t){this.readonly||this.objMask.keydown(t)},e.prototype.hasInvalidClass=function(){return this.el.nativeElement.classList.contains("ng-invalid")&&this.el.nativeElement.classList.contains("ng-dirty")&&""!==this.inputEl.nativeElement.value},e.prototype.getErrorPattern=function(){return""!==this.errorPattern&&this.hasInvalidClass()?this.errorPattern:""},e.prototype.clear=function(){this.valueBeforeChange=this.formatToDate(this.date),this.date=void 0,this.controlModel(this.date),this.controlChangeEmitter()},e.prototype.eventOnBlur=function(t){var e=this.inputEl.nativeElement.value,i=e?this.getDateFromString(e):void 0;this.objMask.blur(t),this.onblur.emit(),this.objMask.valueToModel?this.objMask.valueToModel.length>=10?(this.controlModel(i),this.date=i):(this.date=void 0,this.controlModel(this.date)):(this.date=void 0,this.callOnChange(this.date)),this.controlChangeEmitter()},e.prototype.eventOnChange=function(t){var e=this.inputEl.nativeElement.value;this.verifyMobile()&&(this.controlModel(e),this.callOnChange(e)),this.onchange.emit(e)},e.prototype.eventOnClick=function(t){var e=this;this.verifyMobile()?(t.target.blur(),setTimeout(function(){return e.togglePicker()},0)):this.objMask.click(t)},e.prototype.formatToDate=function(t){if(t){var e=this.format;return e=(e=(e=e.replace("dd",("0"+t.getDate()).slice(-2))).replace("mm",("0"+(t.getMonth()+1)).slice(-2))).replace("yyyy",formatYear(t.getFullYear()))}},e.prototype.refreshValue=function(t){t&&(this.inputEl.nativeElement.value=this.formatToDate(t))},e.prototype.writeValue=function(t){if(this.inputEl&&t){if(t instanceof Date){var e=t.toString();this.hour="T"+e.substring(16,24)+e.substring(28,31)+":"+e.substring(31,33),this.date=t,this.inputEl.nativeElement.value=this.formatToDate(t)}else if(this.isValidDateIso(t)||this.isValidExtendedIso(t)){this.isValidDateIso(t)?this.isExtendedISO=!1:(this.hour=t.substring(10,25),this.isExtendedISO=!0);var i=parseInt(t.substring(8,10),10),n=parseInt(t.substring(5,7),10)-1,o=parseInt(t.substring(0,4),10),r=new Date(o,n,i);setYearFrom0To100(r,o),this.date=r,this.inputEl.nativeElement.value=this.formatToDate(r)}else this.inputEl.nativeElement.value="",this.date=void 0;this.controlModel(this.date)}else this.inputEl&&(this.inputEl.nativeElement.value="",this.date=void 0);this.valueBeforeChange=this.formatToDate(this.date)},e.prototype.isValidDateIso=function(t){return this.dateRegex.test(t)},e.prototype.isValidExtendedIso=function(t){return this.isoRegex.test(t)},e.prototype.hasOverlayClass=function(t){return t.classList.contains("thf-calendar-overlay")},e.prototype.verifyMobile=function(){return isMobile()},e.prototype.closeCalendar=function(){this.calendar.close(),this.removeListeners(),this.setDialogPickerStyleDisplay("none")},e.prototype.controlChangeEmitter=function(){var t=this,e=this.formatToDate(this.date);e!==this.valueBeforeChange&&(this.valueBeforeChange=e,clearTimeout(this.timeoutChange),this.timeoutChange=setTimeout(function(){t.onchange.emit(e)},200))},e.prototype.hasAttrCalendar=function(t){return t&&t.hasAttribute("attr-calendar")||t.parentElement&&t.parentElement.hasAttribute("attr-calendar")},e.prototype.initializeListeners=function(){var t=this;this.clickListener=this.renderer.listen("document","click",function(e){t.wasClickedOnPicker(e)}),this.eventResizeListener=this.renderer.listen("window","resize",function(){t.closeCalendar()}),window.addEventListener("scroll",this.onScroll,!0)},e.prototype.removeListeners=function(){this.clickListener&&this.clickListener(),this.eventResizeListener&&this.eventResizeListener(),window.removeEventListener("scroll",this.onScroll,!0)},e.prototype.setDialogPickerStyleDisplay=function(t){this.dialogPicker.nativeElement.style.display=t},e.prototype.setCalendarPosition=function(){this.setDialogPickerStyleDisplay("block"),this.controlPosition.setElements(this.dialogPicker.nativeElement,thfCalendarContentOffset,this.inputEl,["top-left","bottom-left"],!1,!0),this.controlPosition.adjustPosition(thfCalendarPositionDefault)},e.decorators=[{type:Component,args:[{selector:"thf-datepicker",template:'<thf-field-container [t-help]="help" [t-label]="label" [t-opcional]="!required"> <div class="thf-field-container-content"> <input #inp class="thf-input thf-datepicker" [ngClass]="clean && inp.value ? \'thf-input-double-icon-right\' : \'thf-input-icon-right\'" type="text" [attr.name]="name" [disabled]="disabled" [placeholder]="placeholder" [readonly]="readonly" [required]="required" (blur)="eventOnBlur($event)" (change)="eventOnChange($event)" (click)="eventOnClick($event)"> <div class="thf-field-icon-container-right"> <thf-clean [t-element-ref]="inputEl" (t-change-event)="clear()"></thf-clean> <span #iconDatepicker class="thf-icon thf-field-icon thf-icon-calendar" [class.thf-field-icon]="!disabled && !readonly" [class.thf-field-icon-disabled]="disabled || readonly" (click)="togglePicker()"> </span> </div> </div> <div #dialogPicker [class.thf-datepicker-popup-calendar]="!verifyMobile()"> <thf-calendar #calendar [(t-selected-date)]="date" [t-date-end]="end" [t-date-start]="start" [t-locale]="locale" (t-submit)="dateSelected()"> </thf-calendar> </div> <thf-field-container-bottom [t-error-pattern]="getErrorPattern()"></thf-field-container-bottom> </thf-field-container> ',providers:[{provide:NG_VALUE_ACCESSOR,useExisting:forwardRef(function(){return e}),multi:!0},{provide:NG_VALIDATORS,useExisting:forwardRef(function(){return e}),multi:!0},ThfControlPositionService]}]}],e.ctorParameters=function(){return[{type:ThfControlPositionService},{type:Renderer2},{type:ElementRef}]},e.propDecorators={calendar:[{type:ViewChild,args:["calendar"]}],dialogPicker:[{type:ViewChild,args:["dialogPicker",{read:ElementRef}]}],iconDatepicker:[{type:ViewChild,args:["iconDatepicker",{read:ElementRef}]}],inputEl:[{type:ViewChild,args:["inp",{read:ElementRef}]}],label:[{type:Input,args:["t-label"]}],help:[{type:Input,args:["t-help"]}],onKeyup:[{type:HostListener,args:["keyup",["$event"]]}],onKeydown:[{type:HostListener,args:["keydown",["$event"]]}]},e}(ThfDatepickerBaseComponent);export{ThfDatepickerComponent};