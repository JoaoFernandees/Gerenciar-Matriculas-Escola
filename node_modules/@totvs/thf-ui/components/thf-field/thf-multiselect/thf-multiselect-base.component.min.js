var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};import{EventEmitter,Input,Output}from"@angular/core";import{browserLanguage,convertToBoolean,removeDuplicatedOptions,removeUndefinedAndNullOptions,sortOptionsByProperty,thfLocaleDefault}from"../../../utils/util";import{requiredFailed}from"./../validators";import{ThfMultiselectFilterMode}from"./thf-multiselect-filter-mode.enum";export var thfMultiselectLiteralsDefault={en:{noData:"No data found",placeholderSearch:"Search"},es:{noData:"Datos no encontrados",placeholderSearch:"Busca"},pt:{noData:"Nenhum dado encontrado",placeholderSearch:"Buscar"}};var ThfMultiselectBaseComponent=function(){function t(){this._disabled=!1,this._filterMode=ThfMultiselectFilterMode.startsWith,this._focus=!1,this._hideSearch=!1,this._required=!1,this._sort=!1,this.firstInWriteValue=!0,this.readyToValidation=!1,this.selectedOptions=[],this.visibleOptionsDropdown=[],this.visibleDisclaimers=[],this.placeholder="",this.placeholderSearch="",this.change=new EventEmitter}return Object.defineProperty(t.prototype,"literals",{get:function(){return this._literals||thfMultiselectLiteralsDefault[browserLanguage()]},set:function(t){t instanceof Object&&!(t instanceof Array)?this._literals=__assign({},thfMultiselectLiteralsDefault[thfLocaleDefault],thfMultiselectLiteralsDefault[browserLanguage()],t):this._literals=thfMultiselectLiteralsDefault[browserLanguage()]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"required",{get:function(){return this._required},set:function(t){this._required=""===t||convertToBoolean(t),this.updateModelToValidate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){return this._disabled},set:function(t){this._disabled=""===t||convertToBoolean(t),this.updateModelToValidate(),this.updateVisibleItems()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hideSearch",{get:function(){return this._hideSearch},set:function(t){this._hideSearch=""===t||convertToBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(t){this._options=t,this.validAndSortOptions()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sort",{get:function(){return this._sort},set:function(t){this._sort=""===t||convertToBoolean(t),this.validAndSortOptions()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focus",{get:function(){return this._focus},set:function(t){this._focus=""===t||convertToBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterMode",{get:function(){return this._filterMode},set:function(t){switch(this._filterMode=t in ThfMultiselectFilterMode?t:ThfMultiselectFilterMode.startsWith,this._filterMode.toString()){case"startsWith":this._filterMode=ThfMultiselectFilterMode.startsWith;break;case"contains":this._filterMode=ThfMultiselectFilterMode.contains;break;case"endsWith":this._filterMode=ThfMultiselectFilterMode.endsWith}},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.updateList(this.options)},t.prototype.ngAfterContentChecked=function(){this.readyToValidation=!0},t.prototype.validAndSortOptions=function(){this.options&&this.options.length&&(removeUndefinedAndNullOptions(this.options),removeDuplicatedOptions(this.options),this.setUndefinedLabels(this.options),this.sort&&sortOptionsByProperty(this.options,"label"))},t.prototype.setUndefinedLabels=function(t){t.forEach(function(t){t.label||(t.label=t.value)})},t.prototype.updateList=function(t){t&&(this.visibleOptionsDropdown=t)},t.prototype.updateModelToValidate=function(){var t=this;this.readyToValidation&&setTimeout(function(){t.callOnChange(t.selectedOptions)})},t.prototype.callOnChange=function(t){this.onModelChange&&(this.onModelChange(this.getValuesFromOptions(t)),this.eventChange(t))},t.prototype.eventChange=function(t){t&&this.lastLengthModel!==t.length&&this.change.emit(t),this.lastLengthModel=t?t.length:null},t.prototype.getValuesFromOptions=function(t){return t&&t.length?t.map(function(t){return t.value}):[]},t.prototype.getLabelByValue=function(t){var e=this.options.findIndex(function(e){return e.value===t});return this.options[e].label},t.prototype.changeItems=function(t){this.updateSelectedOptions(t),this.callOnChange(this.selectedOptions)},t.prototype.searchByLabel=function(t,e,o){var i=this;if(t&&e&&e.length){var n=[];e.forEach(function(e){e.label&&i.compareMethod(t,e,o)&&n.push(e)}),this.visibleOptionsDropdown=n}},t.prototype.compareMethod=function(t,e,o){switch(o){case ThfMultiselectFilterMode.startsWith:return this.startsWith(t,e);case ThfMultiselectFilterMode.contains:return this.contains(t,e);case ThfMultiselectFilterMode.endsWith:return this.endsWith(t,e)}},t.prototype.startsWith=function(t,e){return e.label.toLowerCase().startsWith(t.toLowerCase())},t.prototype.contains=function(t,e){return e.label.toLowerCase().indexOf(t.toLowerCase())>-1},t.prototype.endsWith=function(t,e){return e.label.toLowerCase().endsWith(t.toLowerCase())},t.prototype.validate=function(t){return requiredFailed(this.required,this.disabled,t.value)?{required:{valid:!1}}:null},t.prototype.updateSelectedOptions=function(t){var e=this;this.selectedOptions=[],t.forEach(function(t){e.options.forEach(function(o){o.value===t&&e.selectedOptions.push(o)})}),this.updateVisibleItems()},t.prototype.writeValue=function(t){this.firstInWriteValue?this.firstInWriteValue=!1:(t||(t=[],this.callOnChange([])),this.updateSelectedOptions(t),this.selectedOptions.length<t.length&&this.callOnChange(this.selectedOptions))},t.prototype.registerOnChange=function(t){this.onModelChange=t},t.prototype.registerOnTouched=function(t){this.onModelTouched=t},t.propDecorators={label:[{type:Input,args:["t-label"]}],help:[{type:Input,args:["t-help"]}],literals:[{type:Input,args:["t-literals"]}],placeholder:[{type:Input,args:["t-placeholder"]}],placeholderSearch:[{type:Input,args:["t-placeholder-search"]}],name:[{type:Input,args:["name"]}],required:[{type:Input,args:["t-required"]}],disabled:[{type:Input,args:["t-disabled"]}],hideSearch:[{type:Input,args:["t-hide-search"]}],options:[{type:Input,args:["t-options"]}],sort:[{type:Input,args:["t-sort"]}],focus:[{type:Input,args:["t-focus"]}],filterMode:[{type:Input,args:["t-filter-mode"]}],change:[{type:Output,args:["t-change"]}]},t}();export{ThfMultiselectBaseComponent};