var __extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();import{Component,ElementRef,forwardRef,Renderer2,ViewChild}from"@angular/core";import{NG_VALUE_ACCESSOR,NG_VALIDATORS}from"@angular/forms";import{ThfMultiselectBaseComponent}from"./thf-multiselect-base.component";var ThfMultiselectComponent=function(e){function t(t,i){var n=e.call(this)||this;return n.el=t,n.renderer=i,n.disclaimerOffset=0,n.dropdownIcon="thf-icon-arrow-down",n.dropdownOpen=!1,n.initialized=!1,n.visibleElement=!1,n.isCalculateVisibleItems=!0,n}return __extends(t,e),t.prototype.ngAfterViewInit=function(){this.focus&&this.inputElement.nativeElement.focus(),this.initialized=!0,this.initializeResizeListener()},t.prototype.ngDoCheck=function(){var e=this.inputElement.nativeElement.offsetWidth;if(e&&!this.visibleElement&&this.initialized||e&&this.isCalculateVisibleItems)return this.debounceResize(),void(this.visibleElement=!0)},t.prototype.ngOnDestroy=function(){this.removeClickoutListener(),this.removeResizeListener()},t.prototype.getInputWidth=function(){return this.el.nativeElement.querySelector(".thf-input").offsetWidth-40},t.prototype.getDisclaimersWidth=function(){var e=this.el.nativeElement.querySelectorAll("thf-disclaimer");return Array.from(e).map(function(e){return e.offsetWidth})},t.prototype.calculateVisibleItems=function(){var e=this.getDisclaimersWidth(),t=this.getInputWidth(),i=e[0];if(this.visibleDisclaimers=[],t>0){var n=0,o=0;for(o=0;o<this.selectedOptions.length;o++)if(n+=e[o],this.visibleDisclaimers.push(this.selectedOptions[o]),n>t){n-=e[o],this.isCalculateVisibleItems=!1;break}if(i||!this.selectedOptions.length){if(o===this.selectedOptions.length)return void(this.isCalculateVisibleItems=!1);if(n+38>t){this.visibleDisclaimers.splice(-2,2);var s="+"+(this.selectedOptions.length+1-o).toString();this.visibleDisclaimers.push({value:"",label:s})}else{this.visibleDisclaimers.splice(-1,1);s="+"+(this.selectedOptions.length-o).toString();this.visibleDisclaimers.push({value:"",label:s})}}}},t.prototype.updateVisibleItems=function(){this.visibleDisclaimers=[].concat(this.selectedOptions),this.debounceResize(),this.inputElement.nativeElement.offsetWidth||(this.isCalculateVisibleItems=!0)},t.prototype.debounceResize=function(){var e=this;clearTimeout(this.timeoutResize),this.timeoutResize=setTimeout(function(){e.calculateVisibleItems()},200)},t.prototype.onKeyDown=function(e){if(38===e.keyCode||40===e.keyCode)return e.preventDefault(),void this.controlDropdownVisibility(!0);9!==e.keyCode||this.controlDropdownVisibility(!1)},t.prototype.toggleDropdownVisibility=function(){this.disabled||this.controlDropdownVisibility(!this.dropdownOpen)},t.prototype.openDropdown=function(e){e&&!this.disabled&&this.controlDropdownVisibility(!0)},t.prototype.controlDropdownVisibility=function(e){this.dropdownIcon=e?"thf-icon-arrow-up":"thf-icon-arrow-down",this.dropdownOpen=e,this.dropdown.controlVisibility(e),this.setVisibleOptionsDropdown(this.options),e?(this.initializeClickoutListener(),this.setPositionOpeningDropdown()):this.removeClickoutListener()},t.prototype.setPositionOpeningDropdown=function(){var e=this;if(this.selectedOptions&&this.selectedOptions.length){var t=this.options.findIndex(function(t){return t.value===e.selectedOptions[0].value});this.dropdown.scrollTo(t)}},t.prototype.setVisibleOptionsDropdown=function(e){this.visibleOptionsDropdown=e},t.prototype.changeSearch=function(e){e&&e.value?this.searchByLabel(e.value,this.options,this.filterMode):this.setVisibleOptionsDropdown(this.options)},t.prototype.getPlaceholder=function(){return this.placeholder&&!this.visibleDisclaimers.length?this.placeholder:""},t.prototype.closeDisclaimer=function(e){var t=this.selectedOptions.findIndex(function(t){return t.value===e});this.selectedOptions.splice(t,1),this.updateVisibleItems(),this.callOnChange(this.selectedOptions)},t.prototype.wasClickedOnToggle=function(e){this.inputElement.nativeElement.contains(e.target)||this.iconElement.nativeElement.contains(e.target)||this.dropdownElement.nativeElement.contains(e.target)||this.disclaimerContainerElement.nativeElement.contains(e.target)||!this.dropdownOpen||this.controlDropdownVisibility(!1)},t.prototype.initializeClickoutListener=function(){var e=this;this.clickoutListener=this.renderer.listen("document","click",function(t){e.wasClickedOnToggle(t)})},t.prototype.initializeResizeListener=function(){var e=this;this.resizeListener=this.renderer.listen("window","resize",function(t){e.updateVisibleItems()})},t.prototype.removeClickoutListener=function(){this.clickoutListener&&this.clickoutListener()},t.prototype.removeResizeListener=function(){this.resizeListener()},t.decorators=[{type:Component,args:[{selector:"thf-multiselect",template:'<thf-field-container [t-label]="label" [t-help]="help" [t-opcional]="!required"> <div class="thf-field-container-content" [class.thf-multiselect-show]="dropdownOpen"> <input #inputElement class="thf-input thf-input-icon-right thf-clickable" readonly type="text" [value]="getPlaceholder()" [disabled]="disabled" (keydown)="onKeyDown($event)" (click)="toggleDropdownVisibility()"> <div class="thf-field-icon-container-right"> <span #iconElement class="thf-icon thf-field-icon {{ dropdownIcon }}" [ngClass]="disabled ? \'thf-field-icon-disabled\' : \'\'" (click)="toggleDropdownVisibility()"> </span> </div> <div #disclaimerContainer class="thf-multiselect-field" [class.thf-multiselect-field-disabled]="disabled"> <thf-disclaimer *ngFor="let disclaimer of visibleDisclaimers" [t-label]="disclaimer.label" [t-value]="disclaimer.value" [t-hide-close]="disclaimer.value === \'\' || disabled" [class.thf-clickable]="disclaimer.value === \'\' && !disabled" (click)="openDropdown(disclaimer.value === \'\')" (t-close-action)="closeDisclaimer(disclaimer.value)"> </thf-disclaimer> </div> <thf-multiselect-dropdown #dropdownElement [t-hide-search]="hideSearch" [t-literals]="literals" [t-options]="visibleOptionsDropdown" [t-selected-values]="getValuesFromOptions(selectedOptions)" [t-placeholder-search]="placeholderSearch" (t-change)="changeItems($event)" (t-change-search)="changeSearch($event)" (t-close-dropdown)="controlDropdownVisibility(false)"> </thf-multiselect-dropdown> </div> <thf-field-container-bottom></thf-field-container-bottom> </thf-field-container> ',providers:[{provide:NG_VALUE_ACCESSOR,useExisting:forwardRef(function(){return t}),multi:!0},{provide:NG_VALIDATORS,useExisting:forwardRef(function(){return t}),multi:!0}]}]}],t.ctorParameters=function(){return[{type:ElementRef},{type:Renderer2}]},t.propDecorators={dropdownElement:[{type:ViewChild,args:["dropdownElement",{read:ElementRef}]}],dropdown:[{type:ViewChild,args:["dropdownElement"]}],disclaimerContainerElement:[{type:ViewChild,args:["disclaimerContainer",{read:ElementRef}]}],iconElement:[{type:ViewChild,args:["iconElement",{read:ElementRef}]}],inputElement:[{type:ViewChild,args:["inputElement",{read:ElementRef}]}]},t}(ThfMultiselectBaseComponent);export{ThfMultiselectComponent};