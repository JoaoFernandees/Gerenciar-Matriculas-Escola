import{Injectable}from"@angular/core";import{HttpClient,HttpEventType,HttpRequest,HttpResponse}from"@angular/common/http";var ThfUploadBaseService=function(){function e(e){this.http=e,this.formField="files",this.requests=[]}return e.prototype.upload=function(e,t,r,s,i,n){for(var o=t.length,u={data:{},file:null},p=0;p<o;p++){var a=new FormData,f=t[p],l=f.rawFile.name;a.append(this.formField,f.rawFile,l),r&&(u.file=f,r.emit(u),a.append("data",JSON.stringify(u.data))),this.sendFile(e,f,a,s,i,n)}},e.prototype.sendFile=function(e,t,r,s,i,n){var o=this,u=this.getRequest(e,r).subscribe(function(e){if(e.type===HttpEventType.UploadProgress){o.addRequest(t,u);var r=Math.round(100*e.loaded/e.total);s(t,r)}else e instanceof HttpResponse&&i(t,e)},function(e){n(t,e)})},e.prototype.getRequest=function(e,t){var r=new HttpRequest("POST",e,t,{reportProgress:!0});return this.http.request(r)},e.prototype.stopRequestByFile=function(e,t){var r=this.requests.find(function(t){return t.file.uid===e.uid});r&&(r.request.unsubscribe(),this.removeRequest(r),t())},e.prototype.removeRequest=function(e){var t=this.requests.indexOf(e);this.requests.splice(t,1)},e.prototype.addRequest=function(e,t){this.requests.some(function(t){return t.file.uid===e.uid})||this.requests.push({file:e,request:t})},e.decorators=[{type:Injectable}],e.ctorParameters=function(){return[{type:HttpClient}]},e}();export{ThfUploadBaseService};