var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,u)}a((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(r){return function(u){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,u])}}};import{ChangeDetectorRef,Component,ElementRef,Renderer2,ViewContainerRef}from"@angular/core";import{NavigationCancel,NavigationEnd,Router}from"@angular/router";import{map}from"rxjs/operators";import{getFormattedLink,isMobile,openExternalLink}from"../../utils/util";import{ThfMenuBaseComponent}from"./thf-menu-base.component";import{ThfMenuItemsService}from"./services/thf-menu-items.service";import{ThfMenuService}from"./services/thf-menu.service";var thfMenuDebounceTime=400,thfMenuMinLength=3,thfMenuRootLevel=1,ThfMenuComponent=function(e){function t(t,n,i,o,r,s,u){var a=e.call(this,u)||this;return a.element=n,a.renderer=i,a.router=o,a.menuItemsService=r,a.changeDetector=s,a.collapsedMenu=!1,a.filterLoading=!1,a.menuMobileOpened=!1,a.noData=!1,a.filteringItems=!1,a.menuInitialized=!1,a.menuPrevious=null,a.parentRef=t._view.component,a}return __extends(t,e),Object.defineProperty(t.prototype,"isActiveItemMenuSubMenu",{get:function(){return this.activeMenuItem.level>this.groupedMenuItem.level},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableCollapseButton",{get:function(){return this.allowCollapseMenu&&!this.collapsedMenu&&!this.menuMobileOpened},enumerable:!0,configurable:!0}),t.prototype.ngDoCheck=function(){if(!this.filteringItems||!this.filter){var e=JSON.stringify(this.menus);this.menuPrevious===e&&this.menuInitialized||this.updateMenu(),this.validateCollapseClass()}},t.prototype.ngOnDestroy=function(){this.itemSubscription.unsubscribe(),this.routeSubscription.unsubscribe()},t.prototype.ngOnInit=function(){var e=this;this.subscribeToMenuItem(),this.subscribeToRoute(),setTimeout(function(){var t=e.checkingRouterChildrenFragments();e.checkActiveMenuByUrl(t)})},t.prototype.activateMenuByUrl=function(e,t){var n=this;if(t)return t.some(function(t){var i=getFormattedLink(t.link);return i===e?(n.linkActive=i,n.activateMenuItem(t),!0):n.activateMenuByUrl(e,t.subItems)})},t.prototype.checkActiveMenuByUrl=function(e){this.linkActive&&this.linkActive===e||this.activateMenuByUrl(e,this.menus)},t.prototype.debounceFilter=function(e){var t=this;clearTimeout(this.timeoutFilter),this.timeoutFilter=setTimeout(function(){t.filterProcess(e)},thfMenuDebounceTime)},t.prototype.subscribeToMenuItem=function(){var e=this;this.itemSubscription=this.menuItemsService.receiveFromChildMenuClicked().subscribe(function(t){e.clickMenuItem(t)})},t.prototype.subscribeToRoute=function(){var e=this;this.routeSubscription=this.router.events.subscribe(function(t){if(t instanceof NavigationEnd||t instanceof NavigationCancel){var n=e.checkingRouterChildrenFragments();e.checkActiveMenuByUrl(n)}})},t.prototype.toggleMenuCollapse=function(){this.collapsedMenu=!this.collapsedMenu,this.validateCollapseClass(),this.groupedMenuItem&&(this.groupedMenuItem=this.getActiveMenuParent(this.menus,this.activeMenuItem,this.groupedMenuItem)||this.groupedMenuItem,this.toggleGroupedMenuItem()),this.activeMenuItem&&this.activateCollapseSubMenuItem(),this.menuItemsService.sendToChildMenuClicked({active:this.activeMenuItem,grouped:this.groupedMenuItem,activatedByRoute:!0}),this.updateMenu()},t.prototype.toggleMenuMobile=function(){this.menuMobileOpened=!this.menuMobileOpened,isMobile()||this.menuMobileOpened&&this.createResizeListener()},t.prototype.activateCollapseSubMenuItem=function(){this.clearGroupMenuIfFirstLevel(this.activeMenuItem),!this.collapsedMenu&&this.activeMenuItem.level>thfMenuRootLevel&&this.isActiveItemMenuSubMenu&&this.openParentMenu(this.activeMenuItem)},t.prototype.activateMenuItem=function(e){this.activeMenuItem=e,this.linkActive=e.link,this.activeMenuItem.level>thfMenuRootLevel?this.openParentMenu(this.activeMenuItem):this.groupedMenuItem=null,this.menuItemsService.sendToChildMenuClicked({active:this.activeMenuItem,grouped:this.groupedMenuItem,activatedByRoute:!0})},t.prototype.areSubMenus=function(e){return e.every(function(e){return e.level>thfMenuRootLevel})},t.prototype.checkingRouterChildrenFragments=function(){var e=this.router.parseUrl(this.router.url).root.children.primary;return e?"/"+e.segments.map(function(e){return e.path}).join("/"):""},t.prototype.clearGroupMenuIfFirstLevel=function(e){e.level===thfMenuRootLevel&&(this.groupedMenuItem=void 0)},t.prototype.clickMenuItem=function(e){e.action&&this.executeMenuAction(e),"externalLink"===e.type?openExternalLink(e.link):"internalLink"===e.type?this.activateMenuItem(e):"subItems"===e.type&&(this.filteringItems&&(this.filteringItems=!1),this.groupMenuItem(e)),"subItems"!==e.type&&(this.menuMobileOpened=!1)},t.prototype.convertToMenuItemFiltered=function(e){void 0===e&&(e={label:"",link:""});var t={label:e.label,link:e.link};return this.setMenuItemProperties(t),t},t.prototype.createResizeListener=function(){var e=this;this.resizeListener=this.renderer.listen("window","resize",function(){e.menuMobileOpened=!1,e.resizeListener()})},t.prototype.executeMenuAction=function(e){"string"==typeof e.action?this.parentRef[e.action](e):e.action.call(this.parentRef,e)},t.prototype.filterItems=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i;return __generator(this,function(o){switch(o.label){case 0:return(t=e&&e.trim())?(this.filteredItems=[],n=this,this.filterService?[4,this.filterOnService(t)]:[3,2]):[3,4];case 1:return i=o.sent(),[3,3];case 2:i=this.filterLocalItems(t),o.label=3;case 3:return n.filteredItems=i,this.filteringItems=!0,[3,5];case 4:this.filteredItems=this.menus.slice(),this.filteringItems=!1,o.label=5;case 5:return[2]}})})},t.prototype.filterLocalItems=function(e){var t=[];return this.findItems(this.menus,e.toLowerCase(),t),t},t.prototype.filterProcess=function(e){var t=this;this.filterLoading=!0,this.filterItems(e).then(function(){t.filterLoading=!1,t.showNoData(),t.changeDetector.detectChanges(),t.menuItemsService.sendToChildMenuClicked({active:t.activeMenuItem,grouped:t.groupedMenuItem})}).catch(function(e){t.filterLoading=!1,Promise.reject(e)})},t.prototype.filterOnService=function(e){return void 0===e&&(e=""),__awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){switch(n.label){case 0:return e.length>=thfMenuMinLength?[4,this.filterService.getFilteredData(e,this.params).pipe(map(function(e){return e.map(function(e){return t.convertToMenuItemFiltered(e)})})).toPromise()]:[3,2];case 1:return[2,n.sent()];case 2:return[2,this.filteredItems]}})})},t.prototype.findItems=function(e,t,n){var i=this;e.forEach(function(e){(e.label.toLowerCase().includes(t)&&!e.subItems||e.subItems&&i.findItems(e.subItems,t,n))&&n.push(e)})},t.prototype.findParent=function(e,t){var n=function(e,t){if(e)for(var i=0;i<e.length;i++){var o=e[i];if(o.subItems&&o.subItems.find(function(e){return e.id===t}))return o;var r=n(o.subItems,t);if(r)return r}};return n(e,t.id)},t.prototype.findRootParent=function(e,t){var n=this.findParent,i=function(e,t){var o=n(e,t);return o.level!==thfMenuRootLevel&&(o=i(e,o)),o};return i(e,t)},t.prototype.getActiveMenuParent=function(e,t,n){if(this.areSubMenus([n,t]))return this.findRootParent(e,t)},t.prototype.groupMenuItem=function(e){this.collapsedMenu&&this.toggleMenuCollapse(),e.isOpened=!e.isOpened,this.groupedMenuItem=e,this.activeMenuItem&&e.isOpened&&this.isActiveItemMenuSubMenu&&this.isRootMenuEqualGroupedMenu(this.menus,this.activeMenuItem,e)&&this.activateMenuItem(this.activeMenuItem),this.menuItemsService.sendToChildMenuClicked({active:this.activeMenuItem,grouped:this.groupedMenuItem})},t.prototype.isRootMenuEqualGroupedMenu=function(e,t,n){return this.findRootParent(e,t).id===n.id},t.prototype.openParentMenu=function(e){var t=this.findParent(this.menus,e);t.isOpened=!0,this.groupedMenuItem=t},t.prototype.showNoData=function(){this.noData=0===this.filteredItems.length},t.prototype.toggleGroupedMenuItem=function(){this.groupedMenuItem.isOpened=!this.collapsedMenu&&this.allowCollapseMenu},t.prototype.updateMenu=function(){this.menuInitialized=!0,this.setMenuExtraProperties(),this.filteredItems=this.menus.slice(),this.menuPrevious=JSON.stringify(this.menus),this.validateMenus(this.menus)},t.prototype.validateCollapseClass=function(){var e=this.element.nativeElement.parentNode;this.renderer[this.collapsedMenu&&this.allowCollapseMenu?"addClass":"removeClass"](e,"thf-collapsed-menu")},t.decorators=[{type:Component,args:[{selector:"thf-menu",template:'<div *ngIf="menuMobileOpened" class="thf-menu-overlay" (click)="toggleMenuMobile()"></div> <div class="thf-menu-mobile thf-clickable" (click)="toggleMenuMobile()"> <span class="thf-icon thf-icon-menu"></span> </div> <div class="thf-menu" [ngClass]="{ \'thf-menu-animation\' : menuMobileOpened }"> <div class="thf-menu-header-container" [class.thf-menu-header-filter]="filter"> <a href="./"> <div [ngClass]="allowCollapseMenu && collapsedMenu ? \'thf-menu-panel-logo\' : \'thf-menu-logo\'"></div> </a> <a *ngIf="enableCollapseButton" class="thf-collapse-button-icon thf-clickable" (click)="toggleMenuCollapse()"> </a> <thf-menu-filter *ngIf="filter && !collapsedMenu" [t-loading]="filterLoading" (t-filter)="debounceFilter($event)"> </thf-menu-filter> </div> <nav class="thf-menu-container"> \x3c!-- Inner e outer para esconder scroll --\x3e <div class="thf-menu-outer"> <div class="thf-menu-inner"> <div *ngIf="noData" class="thf-menu-item-wrapper"> <div class="thf-menu-item-first"> <div class="thf-menu-icon-container thf-menu-item-no-data"> <span class="thf-icon thf-icon-info thf-menu-icon-item thf-lg-2"></span> <div class="thf-lg-10 thf-menu-icon-label"> {{literals.itemNotFound}} </div> </div> </div> </div> <div *ngFor="let menu of filteredItems, let menuIndex = index;" class="thf-menu-item-wrapper"> <thf-menu-item [class.thf-menu-item-first]="menuIndex === 0" [t-action]="menu.action" [t-collapsed-menu]="collapsedMenu" [t-id]="menu.id" [t-label]="menu.label" [t-icon]="allowIcons ? menu.icon : null" [t-level]="menu.level" [t-link]="menu.link" [t-short-label]="menu.shortLabel" [t-sub-items]="menu.subItems" [t-type]="menu.type"> </thf-menu-item> </div> </div> </div> </nav> <div *ngIf="allowCollapseMenu && collapsedMenu" class="thf-collapse-button-bottom thf-clickable" (click)="toggleMenuCollapse()"> <a class="thf-collapse-button-bottom-icon"><span class="thf-icon thf-icon-menu"></span></a> </div> </div> ',providers:[ThfMenuItemsService,ThfMenuService]}]}],t.ctorParameters=function(){return[{type:ViewContainerRef},{type:ElementRef},{type:Renderer2},{type:Router},{type:ThfMenuItemsService},{type:ChangeDetectorRef},{type:ThfMenuService}]},t}(ThfMenuBaseComponent);export{ThfMenuComponent};