import{HttpResponse}from"@angular/common/http";import{tap}from"rxjs/operators";var NO_ERROR_HEADER_PARAM="X-Totvs-No-Error",ThfHttpInterceptorBaseService=function(){function e(e,t){this.notification=e,this.dialog=t,this.notificationTypes=["success","warning","error","information"]}return e.prototype.intercept=function(e,t){var o=this,r=e.clone();return e=e.headers.has(NO_ERROR_HEADER_PARAM)?this.cloneRequestWithoutNoErrorHeaderParam(e):e,t.handle(e).pipe(tap(function(e){e instanceof HttpResponse&&o.processResponse(e)},function(e){o.processErrorResponse(e,r)}))},e.prototype.processResponse=function(e){var t=this;if(e.body&&e.body.totvs_messages){var o=e.body.totvs_messages;o instanceof Array?o.forEach(function(e){t.showNotification(e)}):this.showNotification(o)}},e.prototype.processErrorResponse=function(e,t){var o=0!==e.status?e.error:{code:0,message:"Servidor não está respondendo.",detailedMessage:e.message},r=this.hasNoErrorParam(t);o&&o.message&&!r&&this.showErrorNotification(o)},e.prototype.cloneRequestWithoutNoErrorHeaderParam=function(e){return e&&e.clone({headers:e.headers.delete(NO_ERROR_HEADER_PARAM)})},e.prototype.hasNoErrorParam=function(e){var t=e&&e.headers.get(NO_ERROR_HEADER_PARAM);return t&&"true"===t.toString().toLocaleLowerCase()},e.prototype.showNotification=function(e){this.notificationTypes.includes(e.type)&&this.notification[e.type]({message:e.detail})},e.prototype.showErrorNotification=function(e){var t=this.generateErrorNotificationAction(e);this.notification.error({message:e.message,actionLabel:t.label,action:t.action})},e.prototype.generateErrorNotificationAction=function(e){var t,o,r=e.message.concat(" "+e.detailedMessage);return e.details&&e.details instanceof Array&&e.details.forEach(function(e){r+="\n"+e.message}),!e.helpUrl||e.detailedMessage||e.details?(e.detailedMessage||e.details)&&(o="Detalhes",t=this.generateDialogDetailFunction(e,r)):(o="Ajuda",t=this.generateUrlHelpFunction(e.helpUrl)),{label:o,action:t}},e.prototype.generateUrlHelpFunction=function(e){return function(){window.open(e,"_blank")}},e.prototype.generateDialogDetailFunction=function(e,t){var o=this;return function(){o.dialog.alert({title:e.code,message:t,ok:e.helpUrl?o.generateUrlHelpFunction(e.helpUrl):void 0})}},e}();export{ThfHttpInterceptorBaseService};