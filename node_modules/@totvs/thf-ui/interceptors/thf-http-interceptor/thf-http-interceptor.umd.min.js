!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs/operators"),require("rxjs"),require("uuid")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common/http","rxjs/operators","rxjs","uuid"],o):o(t["thf-http-interceptor"]={},t.core,t.http,t.operators,t.rxjs,t.uuid)}(this,function(t,o,e,n,i,r){"use strict";var s=function(){function t(t,o){this.notification=t,this.dialog=o,this.notificationTypes=["success","warning","error","information"]}return t.prototype.intercept=function(t,o){var i=this,r=t.clone();return t=t.headers.has("X-Totvs-No-Error")?this.cloneRequestWithoutNoErrorHeaderParam(t):t,o.handle(t).pipe(n.tap(function(t){t instanceof e.HttpResponse&&i.processResponse(t)},function(t){i.processErrorResponse(t,r)}))},t.prototype.processResponse=function(t){var o=this;if(t.body&&t.body.totvs_messages){var e=t.body.totvs_messages;e instanceof Array?e.forEach(function(t){o.showNotification(t)}):this.showNotification(e)}},t.prototype.processErrorResponse=function(t,o){var e=0!==t.status?t.error:{code:0,message:"Servidor não está respondendo.",detailedMessage:t.message},n=this.hasNoErrorParam(o);e&&e.message&&!n&&this.showErrorNotification(e)},t.prototype.cloneRequestWithoutNoErrorHeaderParam=function(t){return t&&t.clone({headers:t.headers.delete("X-Totvs-No-Error")})},t.prototype.hasNoErrorParam=function(t){var o=t&&t.headers.get("X-Totvs-No-Error");return o&&"true"===o.toString().toLocaleLowerCase()},t.prototype.showNotification=function(t){this.notificationTypes.includes(t.type)&&this.notification[t.type]({message:t.detail})},t.prototype.showErrorNotification=function(t){var o=this.generateErrorNotificationAction(t);this.notification.error({message:t.message,actionLabel:o.label,action:o.action})},t.prototype.generateErrorNotificationAction=function(t){var o,e,n=t.message.concat(" "+t.detailedMessage);return t.details&&t.details instanceof Array&&t.details.forEach(function(t){n+="\n"+t.message}),!t.helpUrl||t.detailedMessage||t.details?(t.detailedMessage||t.details)&&(e="Detalhes",o=this.generateDialogDetailFunction(t,n)):(e="Ajuda",o=this.generateUrlHelpFunction(t.helpUrl)),{label:e,action:o}},t.prototype.generateUrlHelpFunction=function(t){return function(){window.open(t,"_blank")}},t.prototype.generateDialogDetailFunction=function(t,o){var e=this;return function(){e.dialog.alert({title:t.code,message:o,ok:t.helpUrl?e.generateUrlHelpFunction(t.helpUrl):void 0})}},t}(),a=function(){function t(t,o,e){this.componentResolver=t,this.applicationRef=o,this.injector=e}return t.prototype.createComponentInApplication=function(t){var o=this.componentResolver.resolveComponentFactory(t).create(this.injector);this.applicationRef.attachView(o.hostView);var e=o.hostView.rootNodes[0];return document.body.appendChild(e),o},t.prototype.destroyComponentInApplication=function(t){this.applicationRef.detachView(t.hostView),t.destroy()},t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.ComponentFactoryResolver},{type:o.ApplicationRef},{type:o.Injector}]},t.ngInjectableDef=o.defineInjectable({factory:function(){return new t(o.inject(o.ComponentFactoryResolver),o.inject(o.ApplicationRef),o.inject(o.INJECTOR))},token:t,providedIn:"root"}),t}(),c={Bottom:0,Top:1};c[c.Bottom]="Bottom",c[c.Top]="Top";var p={Error:0,Information:1,Success:2,Warning:3};p[p.Error]="Error",p[p.Information]="Information",p[p.Success]="Success",p[p.Warning]="Warning";var l,u=function(){function t(){this.stackTop=[],this.stackBottom=[],this.durationToaster=1e4}return t.prototype.success=function(t){this.createToaster(this.buildToaster(t,p.Success))},t.prototype.warning=function(t){this.createToaster(this.buildToaster(t,p.Warning))},t.prototype.error=function(t){this.createToaster(this.buildToaster(t,p.Error))},t.prototype.information=function(t){this.createToaster(this.buildToaster(t,p.Information))},t.prototype.buildToaster=function(t,o){var e,n=this,i=0;void 0===t.orientation||t.orientation===c.Bottom?(i=this.stackBottom.length,e=c.Bottom):(i=this.stackTop.length,e=c.Top);var r={componentRef:void 0,message:t.message||t,type:o,orientation:e,action:t.action,actionLabel:t.actionLabel,position:i};return t.action&&(r.action=function(o){t.action(),n.destroyToaster(o.componentRef)}),r},t}(),f=function(){return function(){this.orientation=c.Bottom}}(),h=(l=function(t,o){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(t,o)},function(t,o){function e(){this.constructor=t}l(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),d=function(t){function e(o,e){var n=t.call(this)||this;return n.changeDetector=o,n.elementeRef=e,n.margin=20,n.observableOnClose=new i.Subject,n.showToaster=!0,n.toasterPosition="thf-toaster-bottom",n}return h(e,t),e.prototype.changePosition=function(t){this.elementeRef.nativeElement.style.display="table",this.margin=6+44*t+6*t,this.orientation===c.Top?this.toaster.nativeElement.style.top=this.margin+"px":this.toaster.nativeElement.style.bottom=this.margin+"px"},e.prototype.close=function(){this.showToaster=!1,this.observableOnClose.next(!0)},e.prototype.configToaster=function(t){switch(this.type=t.type,this.message=t.message,this.orientation=t.orientation,this.position=t.position,this.action=t.action,this.actionLabel=t.actionLabel?t.actionLabel:"Fechar",this.componentRef=t.componentRef,this.orientation===c.Top&&(this.toasterPosition="thf-toaster-top"),this.changePosition(this.position),this.type){case p.Error:this.toasterType="thf-toaster-error",this.icon="thf-icon-close";break;case p.Information:this.toasterType="thf-toaster-info",this.icon="thf-icon-info";break;case p.Success:this.toasterType="thf-toaster-success",this.icon="thf-icon-ok";break;case p.Warning:this.toasterType="thf-toaster-warning",this.icon="thf-icon-warning"}this.changeDetector.detectChanges()},e.prototype.getShowToaster=function(){return this.showToaster},e.prototype.getIcon=function(){return this.icon},e.prototype.getToasterPosition=function(){return this.toasterPosition},e.prototype.getToasterType=function(){return this.toasterType},e.prototype.thfToasterAction=function(){this.action(this)},e.decorators=[{type:o.Component,args:[{selector:"thf-toaster",template:'<div #toaster *ngIf="getShowToaster()" class="thf-toaster {{ getToasterType() }} {{ getToasterPosition() }} thf-clickable" (click)="close()"> <div class="thf-toaster-message"> <span class="thf-icon {{ getIcon() }}"></span> {{ message }} </div> <div *ngIf="action !== undefined" (click)="thfToasterAction()" class="thf-toaster-action"> {{ actionLabel }} </div> </div> '}]}],e.ctorParameters=function(){return[{type:o.ChangeDetectorRef},{type:o.ElementRef}]},e.propDecorators={toaster:[{type:o.ViewChild,args:["toaster"]}]},e}(f),y=function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),m=function(t){function e(o){var e=t.call(this)||this;return e.thfComponentInjector=o,e}return y(e,t),e.prototype.createToaster=function(t){var o=this,e=this.thfComponentInjector.createComponentInApplication(d);t.componentRef=e,e.changeDetectorRef.detectChanges(),e.instance.configToaster(t),t.orientation===c.Top?this.stackTop.push(e):this.stackBottom.push(e),this.observableOnClose(e),void 0===t.action&&setTimeout(function(){o.destroyToaster(e)},this.durationToaster)},e.prototype.destroyToaster=function(t){var o,e=(o=t.instance.orientation===c.Top?this.stackTop:this.stackBottom).indexOf(t);o.splice(e,1),this.thfComponentInjector.destroyComponentInApplication(t);for(var n=0;n<o.length;n++)o[n].instance.changePosition(n)},e.prototype.observableOnClose=function(t){var o=this;t.instance.observableOnClose.subscribe(function(){o.destroyToaster(t)})},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:a}]},e.ngInjectableDef=o.defineInjectable({factory:function(){return new e(o.inject(a))},token:e,providedIn:"root"}),e}(u),g={Alert:0,Confirm:1};g[g.Alert]="Alert",g[g.Confirm]="Confirm";var v=function(){function t(){}return t.prototype.confirm=function(t){this.openDialog(g.Confirm,t)},t.prototype.alert=function(t){this.openDialog(g.Alert,t)},t}(),b=["pt","en","es"],C="pt";function T(){var t=navigator.language.toLowerCase().substring(0,2);return b.includes(t)?t:C}function A(t){return"string"==typeof t?"true"===(t=t.toLowerCase().trim())||"on"===t||""===t:"number"==typeof t?1===t:!!t}var E=function(){function t(){this._hideClose=!1,this._size="md",this.clickOut=!1,this.isHidden=!0,this.onXClosed=new o.EventEmitter}return Object.defineProperty(t.prototype,"size",{get:function(){return this._size},set:function(t){this._size=["sm","md","lg","xl","auto"].indexOf(t)>-1?t:"md"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setClickOut",{set:function(t){this.clickOut=""!==t&&A(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hideClose",{get:function(){return this._hideClose},set:function(t){this._hideClose=A(t)},enumerable:!0,configurable:!0}),t.prototype.close=function(t){void 0===t&&(t=!1),this.isHidden=!0,t&&this.onXClosed.emit(t)},t.prototype.open=function(){this.validPrimaryAction(),this.isHidden=!1},t.prototype.validPrimaryAction=function(){var t=this;this.primaryAction||(this.primaryAction={action:function(){return t.close()},label:"Ok"}),this.primaryAction.action||(this.primaryAction.action=function(){return t.close()}),this.primaryAction.label||(this.primaryAction.label="Ok")},t.propDecorators={title:[{type:o.Input,args:["t-title"]}],primaryAction:[{type:o.Input,args:["t-primary-action"]}],secondaryAction:[{type:o.Input,args:["t-secondary-action"]}],size:[{type:o.Input,args:["t-size"]}],setClickOut:[{type:o.Input,args:["t-click-out"]}],hideClose:[{type:o.Input,args:["t-hide-close"]}]},t}(),O=function(){function t(){}return t.decorators=[{type:o.Injectable}],t}(),_=function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),I=function(t){function e(o){var e=t.call(this)||this;return e.thfModalService=o,e.focusableElements="input, select, textarea, button:not([disabled]), a",e.id=r.v4(),e}return _(e,t),e.prototype.close=function(o){void 0===o&&(o=!1),this.thfModalService.modalActive=void 0,t.prototype.close.call(this,o),document.removeEventListener("focus",this.focusFunction,!0),this.sourceElement&&this.sourceElement.focus()},e.prototype.closeModalOnEscapeKey=function(t){this.hideClose||(t.preventDefault(),t.stopPropagation(),this.close())},e.prototype.getPrimaryActionButtonType=function(){return this.primaryAction.danger?"danger":"primary"},e.prototype.getSecondaryActionButtonType=function(){return this.secondaryAction&&this.secondaryAction.danger&&!this.primaryAction.danger?"danger":"default"},e.prototype.onClickOut=function(t){this.clickOut&&!this.modalContent.nativeElement.contains(t.target)&&this.close()},e.prototype.open=function(){this.sourceElement=document.activeElement,t.prototype.open.call(this),this.handleFocus()},e.prototype.handleFocus=function(){var t=this;this.thfModalService.modalActive=this.id,setTimeout(function(){t.modalContent&&(t.initFocus(),document.addEventListener("focus",t.focusFunction,!0))})},e.prototype.initFocus=function(){var t=this;(this.focusFunction=function(o){t.thfModalService.modalActive=t.thfModalService.modalActive||t.id,t.modalContent.nativeElement.contains(o.target)||t.thfModalService.modalActive!==t.id||(o.stopPropagation(),t.firstElement.focus())},this.setFirstElement(),this.hideClose)?this.firstElement.focus():(this.modalContent.nativeElement.querySelectorAll(this.focusableElements)[1]||this.modalContent.nativeElement).focus()},e.prototype.setFirstElement=function(){this.firstElement=this.modalContent.nativeElement.querySelector(this.focusableElements)||this.modalContent.nativeElement},e.decorators=[{type:o.Component,args:[{selector:"thf-modal",template:'<div *ngIf="!isHidden" class="thf-modal" tabindex="0" (keydown.esc)="closeModalOnEscapeKey($event)"> <div class="thf-modal-overlay"> <div class="thf-modal-container thf-pb-2 thf-pt-2" (click)="onClickOut($event)"> <div class="thf-modal-vertical-align"> <div #modalContent class="thf-modal-content thf-modal-{{ size }}" tabindex="-1"> <div class="thf-modal-header"> <div class="thf-modal-title"> <a *ngIf="!hideClose" class="thf-modal-header-close-button" tabindex="0" (click)="close(true)"> <span class="thf-icon thf-icon-close"></span> </a> {{ title }} </div> </div> <div class="thf-modal-body"> <ng-content></ng-content> </div> <div class="thf-modal-footer"> <thf-button *ngIf="secondaryAction" [t-disabled]="secondaryAction.disabled" [t-label]="secondaryAction.label" [t-loading]="secondaryAction.loading" [t-type]="getSecondaryActionButtonType()" (t-click)="secondaryAction.action()"> </thf-button> <thf-button class="thf-button-modal-first-action" [t-disabled]="primaryAction.disabled" [t-label]="primaryAction.label" [t-loading]="primaryAction.loading" [t-type]="getPrimaryActionButtonType()" (t-click)="primaryAction.action()"> </thf-button> </div> </div> </div> </div> </div> </div> '}]}],e.ctorParameters=function(){return[{type:O}]},e.propDecorators={modalContent:[{type:o.ViewChild,args:["modalContent",{read:o.ElementRef}]}]},e}(E),j=function(){return(j=Object.assign||function(t){for(var o,e=1,n=arguments.length;e<n;e++)for(var i in o=arguments[e])Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i]);return t}).apply(this,arguments)},w={en:{ok:"Ok"},es:{ok:"Ok"},pt:{ok:"Ok"}},k={en:{cancel:"Cancel",confirm:"Confirm"},es:{cancel:"Cancelar",confirm:"Confirmar"},pt:{cancel:"Cancelar",confirm:"Confirmar"}},P=function(){function t(){this.primaryAction={label:"ok",action:function(){}}}return t.prototype.ngOnDestroy=function(){this.closeSubscription.unsubscribe()},t.prototype.ngOnInit=function(){var t=this;this.closeSubscription=this.thfModal.onXClosed.subscribe(function(o){return t.destroy()})},t.prototype.close=function(){this.thfModal.close(),this.destroy()},t.prototype.destroy=function(){this.componentRef&&this.componentRef.destroy()},t.prototype.configDialog=function(t,o,e,n){var i=this;this.primaryAction={label:t,action:function(){o&&o(),i.close()}},e&&(this.secondaryAction={label:e,action:function(){n&&n(),i.close()}})},t.prototype.open=function(t,o,e){switch(this.title=t.title,this.message=t.message,this.componentRef=e,this.setDialogLiterals(t,o),o){case g.Confirm:this.configDialog(this.literalsConfirm.confirm,t.confirm,this.literalsConfirm.cancel,t.cancel);break;case g.Alert:this.configDialog(this.literalsAlert.ok,t.ok)}this.thfModal.open()},t.prototype.setDialogLiterals=function(t,o){var e=w,n=k,i=t.literals;o===g.Alert?this.literalsAlert=j({},e[C],e[T()],i):this.literalsConfirm=j({},n[C],n[T()],i)},t.decorators=[{type:o.Component,args:[{template:'<thf-modal [t-title]="title" [t-primary-action]="primaryAction" [t-secondary-action]="secondaryAction"> {{ message }} </thf-modal> '}]}],t.propDecorators={thfModal:[{type:o.ViewChild,args:[I]}]},t}(),R=function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),D=function(t){function e(o){var e=t.call(this)||this;return e.thfComponentInjector=o,e}return R(e,t),e.prototype.openDialog=function(t,o){var e=this.thfComponentInjector.createComponentInApplication(P);e.changeDetectorRef.detectChanges(),e.instance.open(o,t,e)},e.decorators=[{type:o.Injectable}],e.ctorParameters=function(){return[{type:a}]},e}(v),S=function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),M=function(t){function e(o,e){return t.call(this,o,e)||this}return S(e,t),e.decorators=[{type:o.Injectable}],e.ctorParameters=function(){return[{type:m},{type:D}]},e}(s),x=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{providers:[M,D,m,{provide:e.HTTP_INTERCEPTORS,useClass:M,multi:!0}]}]}],t}();t.ThfHttpInterceptorService=M,t.ThfHttpInterceptorModule=x,Object.defineProperty(t,"__esModule",{value:!0})});