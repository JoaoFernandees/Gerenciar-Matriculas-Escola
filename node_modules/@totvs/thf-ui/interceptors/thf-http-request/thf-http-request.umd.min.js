!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators"],e):e(t["thf-http-request"]={},t.core,t.http,t.rxjs,t.operators)}(this,function(t,e,o,n,r){"use strict";var s=function(){function t(t,e,o){this.componentResolver=t,this.applicationRef=e,this.injector=o}return t.prototype.createComponentInApplication=function(t){var e=this.componentResolver.resolveComponentFactory(t).create(this.injector);this.applicationRef.attachView(e.hostView);var o=e.hostView.rootNodes[0];return document.body.appendChild(o),e},t.prototype.destroyComponentInApplication=function(t){this.applicationRef.detachView(t.hostView),t.destroy()},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:e.ComponentFactoryResolver},{type:e.ApplicationRef},{type:e.Injector}]},t.ngInjectableDef=e.defineInjectable({factory:function(){return new t(e.inject(e.ComponentFactoryResolver),e.inject(e.ApplicationRef),e.inject(e.INJECTOR))},token:t,providedIn:"root"}),t}();var i,c=function(){function t(){this._screenLock=!1,this.text="Carregando"}return Object.defineProperty(t.prototype,"screenLock",{get:function(){return this._screenLock},set:function(t){var e;this._screenLock="string"==typeof(e=t)?"true"===(e=e.toLowerCase().trim())||"on"===e||""===e:"number"==typeof e?1===e:!!e},enumerable:!0,configurable:!0}),t.propDecorators={screenLock:[{type:e.Input,args:["t-screen-lock"]}],text:[{type:e.Input,args:["t-text"]}]},t}(),a=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),p=function(t){function o(e){var o=t.call(this)||this;return o.changeDetector=e,o}return a(o,t),o.decorators=[{type:e.Component,args:[{selector:"thf-loading-overlay",template:'<div [class.thf-overlay-absolute]="!screenLock" [class.thf-overlay-fixed]="screenLock"> <thf-loading class="thf-loading-overlay-content" [t-text]="text"></thf-loading> </div> '}]}],o.ctorParameters=function(){return[{type:e.ChangeDetectorRef}]},o}(c),u=function(){function t(){this.controlHttpRequest=new n.Subject}return t.prototype.getControlHttpRequest=function(){return this.controlHttpRequest.asObservable()},t.prototype.send=function(t){void 0===t&&(t=0),this.controlHttpRequest.next(t)},t.decorators=[{type:e.Injectable}],t}(),l=function(){function t(t,e){this.controlHttpRequest=t,this.thfComponentInjector=e,this.loadingOverlayComponent=void 0,this.pendingRequests=0,this.overlayRequests=0}return t.prototype.intercept=function(t,e){var s=this,i=t.clone();return t=this.requestCloneWithoutHeaderParam(["X-Totvs-No-Count-Pending-Requests","X-Totvs-Screen-Lock"],t),this.setCountPendingRequests(!0,i),this.setCountOverlayRequests(!0,i),e.handle(t).pipe(r.tap(function(t){t instanceof o.HttpResponse&&(s.setCountPendingRequests(!1,i),s.setCountOverlayRequests(!1,i))}),r.catchError(function(t){return s.setCountPendingRequests(!1,i),s.setCountOverlayRequests(!1,i),n.throwError(t)}))},t.prototype.getCountPendingRequests=function(){return this.controlHttpRequest.getControlHttpRequest()},t.prototype.buildLoading=function(){this.loadingOverlayComponent||(this.loadingOverlayComponent=this.thfComponentInjector.createComponentInApplication(p),this.loadingOverlayComponent.instance.screenLock=!0,this.loadingOverlayComponent.instance.changeDetector.detectChanges())},t.prototype.destroyLoading=function(){this.loadingOverlayComponent&&(this.thfComponentInjector.destroyComponentInApplication(this.loadingOverlayComponent),this.loadingOverlayComponent=void 0)},t.prototype.requestCloneWithoutHeaderParam=function(t,e){var o=!1;return t.forEach(function(t){e.headers.has(t)&&(e.headers.delete(t),o=!0)}),o?e.clone({headers:e.headers}):e},t.prototype.setCountPendingRequests=function(t,e){var o=e.headers.has("X-Totvs-No-Count-Pending-Requests"),n=e.headers.get("X-Totvs-No-Count-Pending-Requests");o&&"true"===n.toString().toLowerCase()||(this.pendingRequests+=t?1:-1,this.controlHttpRequest.send(this.pendingRequests))},t.prototype.setCountOverlayRequests=function(t,e){if(e.headers.has("X-Totvs-Screen-Lock")){if("false"===e.headers.get("X-Totvs-Screen-Lock").toString().toLowerCase())return;this.overlayRequests+=t?1:-1,this.overlayRequests>0?this.buildLoading():this.destroyLoading()}},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:u},{type:s}]},t.ngInjectableDef=e.defineInjectable({factory:function(){return new t(e.inject(u),e.inject(s))},token:t,providedIn:"root"}),t}(),f=function(){function t(){this.text="Carregando"}return t.propDecorators={text:[{type:e.Input,args:["t-text"]}]},t}(),d=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),h=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return d(o,t),o.decorators=[{type:e.Component,args:[{selector:"thf-loading",template:'<div class="thf-loading"> <span class="thf-loading-icon"></span> <span class="thf-loading-label thf-text-ellipsis" *ngIf="text">{{text}}</span> </div> '}]}],o}(f),y=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{providers:[u,l,s,{provide:o.HTTP_INTERCEPTORS,useClass:l,multi:!0}],entryComponents:[p,h]}]}],t}();t.ThfHttpRequestInterceptorService=l,t.ThfHttpRequestModule=y,Object.defineProperty(t,"__esModule",{value:!0})});