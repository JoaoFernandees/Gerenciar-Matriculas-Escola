!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common/http","rxjs"],e):e(t["thf-i18n"]={},t.core,t.http,t.rxjs)}(this,function(t,e,r,n){"use strict";var o,a=function(){function t(){}return t.prototype.transform=function(t,e){if(!t)return"";e instanceof Array||(e=[e]);for(var r=0,n=e;r<n.length;r++){var o=n[r];t=t.replace(/(\{\w*\})+/,o)}return t},t}(),i=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),s=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return i(r,t),r.decorators=[{type:e.Pipe,args:[{name:"thfI18n"}]}],r}(a),c=new e.InjectionToken("I18N_CONFIG"),u=function(){function t(t,e){this.config=t,this.http=e,this.varI18n={},this.useCache=!1,this.servicesContext={},this.setConfig(t)}return t.prototype.setConfig=function(t){if(t.default&&(t.default.language?this.languageDefault=t.default.language.toLowerCase():this.languageDefault=navigator.language.toLowerCase(),this.contextDefault=t.default.context?t.default.context:"",this.useCache=!!t.default.cache&&t.default.cache),t.contexts&&(this.setVarI18n(t.contexts),!this.contextDefault))for(var e in t.contexts)if(this.config.contexts.hasOwnProperty(e)){this.contextDefault=e;break}},t.prototype.getLiterals=function(t){var e=this;void 0===t&&(t={});var r=t.language?t.language.toLowerCase():this.languageDefault.toLowerCase(),o=t.context?t.context:this.contextDefault,a=t.literals?t.literals:[];return new n.Observable(function(t){e.servicesContext[o]?e.getLiteralsFromContextService(r,o,a,t):e.getLiteralsFromContextConstant(r,o,a,t)})},t.prototype.getLiteralsFromContextService=function(t,e,r,n,o,a){void 0===o&&(o={}),void 0===a&&(a=null);var i=a||t;o=this.mergeObject(o,this.searchInVarI18n(i,e,r)),this.countObject(o)>0&&n.next(o),r.length>0?r.length>this.countObject(o)&&this.getLiteralsLocalStorageAndCache(i,e,r,n,o,a):this.getLiteralsLocalStorageAndCache(i,e,r,n,o,a)},t.prototype.getLiteralsLocalStorageAndCache=function(t,e,r,n,o,a){var i=this;void 0===a&&(a=null);var s,c=a||t;this.useCache&&(s=this.searchInLocalStorage(c,e,r),this.countObject(s)>0&&(this.updateVarI18n(t,e,s),o=this.mergeObject(o,s),n.next(o))),this.getHttpService(this.servicesContext[e],c,r).subscribe(function(c){c&&(i.updateLocalStorage(t,e,c),i.updateVarI18n(t,e,c),s=i.searchInVarI18n(t,e,r),o=i.mergeObject(o,s),n.next(o)),r.length>i.countObject(o)&&("pt-br"===a?(o=i.completeFaultLiterals(t,e,r,o),i.updateLocalStorage(t,e,o),i.updateVarI18n(t,e,o),n.next(o)):i.getLiteralsFromContextService(t,e,r,n,o,"pt-br"))})},t.prototype.getLiteralsFromContextConstant=function(t,e,r,n,o){void 0===o&&(o={}),o=this.mergeObject(o,this.searchInVarI18n(t,e,r)),this.countObject(o)>0&&n.next(o),r.length>0?r.length>this.countObject(o)&&("pt-br"===t?(o=this.completeFaultLiterals(t,e,r,o),n.next(o)):this.getLiteralsFromContextConstant("pt-br",e,r,n,o)):(0===this.countObject(o)&&"pt-br"!==t&&this.getLiteralsFromContextConstant("pt-br",e,r,n,o),n.next(o),n.complete())},t.prototype.searchInLocalStorage=function(t,e,r){var n={};if(r.length>0)for(var o=0;o<r.length;o++){var a=r[o],i=localStorage.getItem(t+"-"+e+"-"+a);i&&(n[a]=i)}return n},t.prototype.searchInVarI18n=function(t,e,r){var n={};if(this.varI18n[t]&&this.varI18n[t][e]){var o=this.varI18n[t][e];if(r.length>0)for(var a=0;a<r.length;a++){var i=r[a];o.hasOwnProperty(i)&&(n[i]=o[i])}else n=o}return n},t.prototype.updateLocalStorage=function(t,e,r){if(this.useCache)for(var n in r)r.hasOwnProperty(n)&&localStorage.setItem(t+"-"+e+"-"+n,r[n])},t.prototype.setVarI18n=function(t){for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];"url"===n?this.servicesContext[e]=o:this.updateVarI18n(n,e,o)}}},t.prototype.updateVarI18n=function(t,e,r){var n;t=t.toLowerCase(),this.varI18n[t]||(this.varI18n[t]=((n={})[e]={},n)),this.varI18n[t][e]||(this.varI18n[t][e]={}),this.varI18n[t][e]=this.mergeObject(r,this.varI18n[t][e])},t.prototype.getHttpService=function(t,e,r){var n="?language="+e;return r.length>0&&(n+="&literals="+r.join()),t=t.lastIndexOf("/")===t.length-1?t.substr(0,t.length-1):t,this.http.get(t+n)},t.prototype.completeFaultLiterals=function(t,e,r,n){for(var o=0;o<r.length;o++){var a=r[o];n[a]||(n[a]=a)}return n},t.prototype.countObject=function(t){return Object.keys(t).length},t.prototype.mergeObject=function(t,e){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},t.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[c]}]},{type:r.HttpClient,decorators:[{type:e.Inject,args:[r.HttpClient]}]}]},t}(),l=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),h=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return l(r,t),r.decorators=[{type:e.Injectable}],r}(u);function p(t,e){return new h(t,e)}var f=function(){function t(){}return t.config=function(e){return{ngModule:t,providers:[{provide:c,useValue:e},{provide:h,useFactory:p,deps:[c,r.HttpClient]}]}},t.decorators=[{type:e.NgModule,args:[{}]}],t}();t.ThfI18nPipe=s,t.returnThfI18nService=p,t.ThfI18nService=h,t.ThfI18nModule=f,Object.defineProperty(t,"__esModule",{value:!0})});